<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>IT13_Final</title>
    <base href="/" />
    <link rel="stylesheet" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'light-blue-gray': '#A2B9CD',
                        'platinum': '#E0E0E0',
                        'uranian-blue': '#A7CCED',
                        'yinmn-blue': '#304D6D',
                        'air-blue': '#82A0BC',
                    },
                },
            },
        }
    </script>
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="IT13_Final.styles.css" />
    <link rel="icon" href="data:,">
</head>

<body>

    <div class="status-bar-safe-area"></div>

    <div id="app">Loading...</div>

    <div id="blazor-error-ui" data-nosnippet>
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    
    <!-- jsPDF Library for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <script>
        window.generateAndPrintPDF = function(logs, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text('Activity Log Report', 14, 20);
                
                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, 30);
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, 36);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 42);
                
                // Table Data
                const tableData = logs.map(log => [
                    log.status || '',
                    log.module || '',
                    log.description || '',
                    `${log.date || ''} ${log.time || ''}`
                ]);
                
                // Create table
                doc.autoTable({
                    startY: 48,
                    head: [['Status', 'Module', 'Description', 'Date']],
                    body: tableData,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [144, 238, 145],
                        textColor: [15, 63, 17],
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 8,
                        cellPadding: 3
                    },
                    columnStyles: {
                        0: { cellWidth: 30 },
                        1: { cellWidth: 35 },
                        2: { cellWidth: 80 },
                        3: { cellWidth: 40 }
                    }
                });
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }
                
                // Generate PDF blob
                const pdfBlob = doc.output('blob');
                
                // Download PDF
                doc.save('Activity_Log_Report.pdf');
                
                // Open PDF in new window for printing
                const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl);
                
                if (printWindow) {
                    // Wait for PDF to load, then trigger print
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        // Clean up the object URL after printing
                        setTimeout(() => {
                            URL.revokeObjectURL(pdfUrl);
                        }, 1000);
                    }, 1000);
                } else {
                    // If popup blocked, try alternative method
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.target = '_blank';
                    link.click();
                }
            } catch (error) {
                console.error('Error generating PDF:', error);
                // Fallback to regular print
                window.print();
            }
        };

        // Function to generate and print sales report PDF - Professional Format matching Admin Records
        window.generateAndPrintSalesReport = function(sales, userName, fromDate, toDate, title) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values from sales data
                const totalSalesAmount = sales.reduce((sum, sale) => {
                    const amount = String(sale.amount || 0).replace(/â‚±/g, '').replace(/,/g, '').trim();
                    return sum + parseFloat(amount || 0);
                }, 0);
                const vatAmount = totalSalesAmount * 0.12;
                const adminFeeAmount = totalSalesAmount * 0.02; // Approximate, actual is calculated from revenue
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(title || 'Sales Reports', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Cashier Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Seller'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Transactions: ' + (sales ? sales.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(30);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Sales Amount: â‚±' + totalSalesAmount.toFixed(2), 15, yPos);
                yPos += 5;
                doc.text('VAT (12%): â‚±' + vatAmount.toFixed(2), 15, yPos);
                yPos += 5;
                doc.text('Admin Fee (2%): â‚±' + adminFeeAmount.toFixed(2), 15, yPos);
                
                // === SALES TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const salesData = sales && sales.length > 0
                    ? sales.map(sale => {
                        const amount = String(sale.amount || 0).replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            sale.saleNumber || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            sale.paymentMethod || '',
                            sale.cashierName || '',
                            `${sale.date || ''} ${sale.time || ''}`
                        ];
                    })
                    : [['No sales found', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Sale Number', 'Amount', 'Payment Method', 'Cashier', 'Date']],
                    body: salesData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 40 },
                        1: { cellWidth: 30, halign: 'right' },
                        2: { cellWidth: 35 },
                        3: { cellWidth: 40 },
                        4: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SAL-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Sales_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print Sales Reports PDF (Accounting) - New format
        window.printSalesReports = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Sales Report (All Cashiers)', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Accounting Portal â€¢ ' + (data.dateRange || 'All Time'), pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Accounting'), 15, yPos);
                doc.text('Date: ' + (data.printedAt || ''), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Transactions: ' + (data.kpi.totalTransactions || '0'), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Sales Amount: â‚±' + (data.kpi.totalSales || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Transactions: ' + (data.kpi.totalTransactions || '0'), 15, yPos);
                yPos += 5;
                doc.text('VAT (12%): â‚±' + (data.kpi.vat || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Admin Fee (2%): â‚±' + (data.kpi.adminFee || '0.00'), 15, yPos);
                
                // === SALES TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const salesData = data.sales && data.sales.length > 0
                    ? data.sales.map(s => {
                        const amount = String(s.amount || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            s.saleNumber || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            s.paymentMethod || '',
                            s.cashierName || '',
                            (s.date || '') + ' ' + (s.time || '')
                        ];
                    })
                    : [['No sales found', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Sale Number', 'Amount', 'Payment Method', 'Cashier', 'Date & Time']],
                    body: salesData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto', halign: 'right' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto' },
                        4: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SAL-REP-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Sales_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print Expense report PDF
        window.generateAndPrintExpenseReport = function(expenses, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text('Expense Report', 14, 20);

                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, 30);
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, 36);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 42);

                const tableData = expenses.map(exp => {
                    const amount = String(exp.amount || 0).replace(/Â±/g, '').trim();
                    return [
                        exp.date || '',
                        exp.type || '',
                        exp.description || '',
                        'â‚±' + parseFloat(amount || 0).toFixed(2),
                        exp.createdBy || ''
                    ];
                });

                doc.autoTable({
                    startY: 48,
                    head: [['Date', 'Type', 'Description', 'Amount', 'Created By']],
                    body: tableData,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [144, 238, 145],
                        textColor: [15, 63, 17],
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 8,
                        cellPadding: 3
                    },
                    columnStyles: {
                        0: { cellWidth: 25 },
                        1: { cellWidth: 30 },
                        2: { cellWidth: 70 },
                        3: { cellWidth: 30 },
                        4: { cellWidth: 35 }
                    }
                });

                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }

                const pdfBlob = doc.output('blob');
                doc.save('Expense_Report.pdf');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl);

                if (printWindow) {
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        setTimeout(() => {
                            URL.revokeObjectURL(pdfUrl);
                        }, 1000);
                    }, 1000);
                } else {
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.target = '_blank';
                    link.click();
                }
            } catch (error) {
                console.error('Error generating Expense PDF:', error);
                window.print();
            }
        };

        // Function to generate and print Income Breakdown PDF
        window.generateAndPrintIncomePDF = function(summary, categories, sellers, payments, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Income Breakdown Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Accounting'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                
                // === SUMMARY SECTION ===
                yPos += 10;
                checkNewPage(50);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Gross Sales: ' + (summary.totalGrossSales || 'â‚±0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Returns: ' + (summary.totalReturns || 'â‚±0.00'), 15, yPos);
                yPos += 5;
                doc.text('Net Income (before expenses): ' + (summary.netIncome || 'â‚±0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Transactions: ' + (summary.totalTransactions || '0'), 15, yPos);
                yPos += 5;
                doc.text('VAT (12%): ' + (summary.vat || 'â‚±0.00'), 15, yPos);
                yPos += 5;
                doc.text('Admin Fee (2%): ' + (summary.adminFee || 'â‚±0.00'), 15, yPos);
                
                // === BY CATEGORY TABLE ===
                if (categories && categories.length > 0) {
                    yPos += 10;
                    checkNewPage(50);
                    
                    const categoryData = categories.map(c => {
                        const amount = String(c.amount || 'â‚±0.00').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            c.category || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            c.items || '0'
                        ];
                    });
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Category', 'Amount', 'Items']],
                        body: categoryData,
                        theme: 'grid',
                        headStyles: { 
                            fillColor: [30, 58, 95], 
                            fontSize: 8, 
                            fontStyle: 'bold',
                            textColor: [255, 255, 255]
                        },
                        bodyStyles: { fontSize: 7 },
                        columnStyles: {
                            0: { cellWidth: 'auto' },
                            1: { cellWidth: 'auto', halign: 'right' },
                            2: { cellWidth: 'auto', halign: 'right' }
                        },
                        margin: { left: 15, right: 15 },
                        didDrawPage: function(data) {
                            doc.setFontSize(8);
                            doc.setTextColor(128);
                            doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                        }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 10;
                }
                
                // === BY SELLER TABLE ===
                if (sellers && sellers.length > 0) {
                    yPos += 5;
                    checkNewPage(50);
                    
                    const sellerData = sellers.map(s => {
                        const amount = String(s.amount || 'â‚±0.00').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            s.seller || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            s.transactions || '0'
                        ];
                    });
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Seller', 'Amount', 'Transactions']],
                        body: sellerData,
                        theme: 'grid',
                        headStyles: { 
                            fillColor: [30, 58, 95], 
                            fontSize: 8, 
                            fontStyle: 'bold',
                            textColor: [255, 255, 255]
                        },
                        bodyStyles: { fontSize: 7 },
                        columnStyles: {
                            0: { cellWidth: 'auto' },
                            1: { cellWidth: 'auto', halign: 'right' },
                            2: { cellWidth: 'auto', halign: 'right' }
                        },
                        margin: { left: 15, right: 15 },
                        didDrawPage: function(data) {
                            doc.setFontSize(8);
                            doc.setTextColor(128);
                            doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                        }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 10;
                }
                
                // === BY PAYMENT METHOD TABLE ===
                if (payments && payments.length > 0) {
                    yPos += 5;
                    checkNewPage(50);
                    
                    const paymentData = payments.map(p => {
                        const amount = String(p.amount || 'â‚±0.00').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            p.method || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            p.percentage || '0%'
                        ];
                    });
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Payment Method', 'Amount', 'Percentage']],
                        body: paymentData,
                        theme: 'grid',
                        headStyles: { 
                            fillColor: [30, 58, 95], 
                            fontSize: 8, 
                            fontStyle: 'bold',
                            textColor: [255, 255, 255]
                        },
                        bodyStyles: { fontSize: 7 },
                        columnStyles: {
                            0: { cellWidth: 'auto' },
                            1: { cellWidth: 'auto', halign: 'right' },
                            2: { cellWidth: 'auto', halign: 'right' }
                        },
                        margin: { left: 15, right: 15 },
                        didDrawPage: function(data) {
                            doc.setFontSize(8);
                            doc.setTextColor(128);
                            doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                        }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 10;
                }
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: INC-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Income_Breakdown_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating Income PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print Cash-in / Cash-out Audit PDF
        window.generateAndPrintCashflowPDF = function(summary, cashIn, cashOut, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Cash-in / Cash-out Audit Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Accounting'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                
                // === SUMMARY SECTION ===
                yPos += 10;
                checkNewPage(50);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Cash-in: â‚±' + (summary.totalCashIn || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Cash-out: â‚±' + (summary.totalCashOut || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Net Cash Movement: â‚±' + (summary.netCash || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('VAT (12%): â‚±' + (summary.vat || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Admin Fee (2%): â‚±' + (summary.adminFee || '0.00'), 15, yPos);
                
                // === CASH-IN TABLE ===
                if (cashIn && cashIn.length > 0) {
                    yPos += 10;
                    checkNewPage(50);
                    
                    const cashInData = cashIn.map(c => {
                        const amount = String(c.amount || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            (c.date || '') + ' ' + (c.time || ''),
                            c.cashier || '',
                            c.source || '',
                            c.module || '',
                            c.reference || '-',
                            'â‚±' + parseFloat(amount || 0).toFixed(2)
                        ];
                    });
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Date & Time', 'Cashier / Accounting', 'Source', 'Module', 'Reference', 'Amount']],
                        body: cashInData,
                        theme: 'grid',
                        headStyles: { 
                            fillColor: [30, 58, 95], 
                            fontSize: 8, 
                            fontStyle: 'bold',
                            textColor: [255, 255, 255]
                        },
                        bodyStyles: { fontSize: 7 },
                        columnStyles: {
                            0: { cellWidth: 'auto' },
                            1: { cellWidth: 'auto' },
                            2: { cellWidth: 'auto' },
                            3: { cellWidth: 'auto' },
                            4: { cellWidth: 'auto' },
                            5: { cellWidth: 'auto', halign: 'right' }
                        },
                        margin: { left: 15, right: 15 },
                        didDrawPage: function(data) {
                            doc.setFontSize(8);
                            doc.setTextColor(128);
                            doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                        }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 10;
                }
                
                // === CASH-OUT TABLE ===
                if (cashOut && cashOut.length > 0) {
                    yPos += 5;
                    checkNewPage(50);
                    
                    const cashOutData = cashOut.map(c => {
                        const amount = String(c.amount || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            (c.date || '') + ' ' + (c.time || ''),
                            c.cashier || '',
                            c.source || '',
                            c.module || '',
                            c.reference || '-',
                            'â‚±' + parseFloat(amount || 0).toFixed(2)
                        ];
                    });
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Date & Time', 'Cashier / Accounting', 'Source', 'Module', 'Reference', 'Amount']],
                        body: cashOutData,
                        theme: 'grid',
                        headStyles: { 
                            fillColor: [30, 58, 95], 
                            fontSize: 8, 
                            fontStyle: 'bold',
                            textColor: [255, 255, 255]
                        },
                        bodyStyles: { fontSize: 7 },
                        columnStyles: {
                            0: { cellWidth: 'auto' },
                            1: { cellWidth: 'auto' },
                            2: { cellWidth: 'auto' },
                            3: { cellWidth: 'auto' },
                            4: { cellWidth: 'auto' },
                            5: { cellWidth: 'auto', halign: 'right' }
                        },
                        margin: { left: 15, right: 15 },
                        didDrawPage: function(data) {
                            doc.setFontSize(8);
                            doc.setTextColor(128);
                            doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                        }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 10;
                }
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: CASH-AUDIT-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Cashflow_Audit_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating Cashflow PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print Tax Report PDF
        window.generateAndPrintTaxReport = function(summary, productRows, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text('Tax Report', 14, 20);

                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, 30);
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, 36);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 42);

                // Summary
                doc.setFontSize(11);
                doc.setTextColor(40, 40, 40);
                let yPos = 52;
                doc.text(`Total Sales (Before Tax): ${summary.totalSalesBeforeTax || 'â‚±0.00'}`, 14, yPos);
                yPos += 6;
                doc.text(`VAT (12%): ${summary.vatAmount || 'â‚±0.00'}`, 14, yPos);
                yPos += 6;
                doc.text(`Admin Fee (2% per product): ${summary.adminFeeAmount || 'â‚±0.00'}`, 14, yPos);
                yPos += 6;
                doc.text(`Total Tax & Fees: ${summary.totalTaxAndFees || 'â‚±0.00'}`, 14, yPos);
                yPos += 10;

                // Product Admin Fee Table
                if (productRows && productRows.length > 0) {
                    doc.setFontSize(12);
                    doc.text('Product-Level Admin Fee Details', 14, yPos);
                    yPos += 4;

                    const tableData = productRows.map(p => {
                        const revenue = String(p.totalRevenue || 0).replace(/Â±/g, '').trim();
                        const adminFee = String(p.adminFee || 0).replace(/Â±/g, '').trim();
                        return [
                            (p.productName || '') + ' - ' + (p.variantName || ''),
                            (p.quantitySold || 0).toString(),
                            'â‚±' + parseFloat(revenue || 0).toFixed(2),
                            'â‚±' + parseFloat(adminFee || 0).toFixed(2)
                        ];
                    });

                    doc.autoTable({
                        startY: yPos,
                        head: [['Product', 'Quantity', 'Revenue', 'Admin Fee (2%)']],
                        body: tableData,
                        theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                        styles: {
                            fontSize: 8,
                            cellPadding: 3
                        },
                        columnStyles: {
                            0: { cellWidth: 70 },
                            1: { cellWidth: 25 },
                            2: { cellWidth: 35 },
                            3: { cellWidth: 35 }
                        },
                        foot: [['Total', (summary.totalProductsSold || 0).toString(), 'â‚±' + parseFloat(String(summary.totalProductRevenue || 0).replace(/Â±/g, '').trim() || 0).toFixed(2), 'â‚±' + parseFloat(String(summary.adminFeeAmount || 0).replace(/Â±/g, '').trim() || 0).toFixed(2)]],
                    footStyles: {
                        fillColor: [144, 238, 145],
                        textColor: [15, 63, 17],
                        fontStyle: 'bold'
                    }
                    });
                }

                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }

                const pdfBlob = doc.output('blob');
                const pdfUrl = URL.createObjectURL(pdfBlob);

                doc.save('Tax_Report.pdf');

                const printWindow = window.open(pdfUrl);
                if (printWindow) {
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        setTimeout(() => URL.revokeObjectURL(pdfUrl), 1000);
                    }, 1000);
                }
            } catch (error) {
                console.error('Error generating Tax Report PDF:', error);
                window.print();
            }
        };

        // Function to generate and print Profit & Loss Statement PDF
        window.generateAndPrintProfitLossReport = function(summary, expenseRows, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Header
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text('Profit & Loss Statement', 14, 20);

                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, 30);
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, 36);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 42);

                // Summary
                doc.setFontSize(11);
                doc.setTextColor(40, 40, 40);
                const cleanAmount = (val) => parseFloat(String(val || 0).replace(/Â±/g, '').trim() || 0).toFixed(2);
                const lines = [
                    `Gross Sales: â‚±${cleanAmount(summary.grossSales)}`,
                    `Returns: â‚±${cleanAmount(summary.returns)}`,
                    `Net Sales: â‚±${cleanAmount(summary.netSales)}`,
                    `Total Expenses: â‚±${cleanAmount(summary.totalExpenses)}`,
                    `Net Profit / (Loss): â‚±${cleanAmount(summary.netProfit)}`
                ];
                lines.forEach((line, idx) => {
                    doc.text(line, 14, 50 + idx * 6);
                });

                // Expense breakdown table
                const tableData = (expenseRows || []).map(row => {
                    const amount = String(row.amount || 0).replace(/Â±/g, '').trim();
                    return [
                        row.type || '',
                        'â‚±' + parseFloat(amount || 0).toFixed(2)
                    ];
                });

                doc.autoTable({
                    startY: 50 + lines.length * 6 + 6,
                    head: [['Expense Type', 'Amount']],
                    body: tableData,
                    theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                    styles: {
                        fontSize: 9,
                        cellPadding: 3
                    },
                    columnStyles: {
                        0: { cellWidth: 90 },
                        1: { cellWidth: 40 }
                    }
                });

                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }

                const pdfBlob = doc.output('blob');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                doc.save('Profit_Loss_Statement.pdf');

                const printWindow = window.open(pdfUrl);
                if (printWindow) {
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        setTimeout(() => URL.revokeObjectURL(pdfUrl), 1000);
                    }, 1000);
                }
            } catch (error) {
                console.error('Error generating Profit & Loss PDF:', error);
                window.print();
            }
        };

        // Function to generate and print Profit & Loss Statement PDF (Accounting) - New format
        window.printProfitLoss = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                // Extract data with fallbacks for property name variations
                const summaryData = data.summary || {};
                const incomeData = data.income || {};
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Profit & Loss Statement', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = data.dateRange || 'All Time';
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Accounting'), 15, yPos);
                doc.text('Date: ' + (data.printedAt || ''), pageWidth - 15, yPos, { align: 'right' });
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(50);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Financial Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Gross Sales: â‚±' + (summaryData.grossSales || summaryData.GrossSales || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Returns: â‚±' + (summaryData.returns || summaryData.Returns || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Net Sales: â‚±' + (summaryData.netSales || summaryData.NetSales || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Expenses: â‚±' + (summaryData.totalExpenses || summaryData.TotalExpenses || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Net Profit / (Loss): â‚±' + (summaryData.netProfit || summaryData.NetProfit || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('VAT (12%): â‚±' + (summaryData.vat || summaryData.Vat || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Admin Fee (2%): â‚±' + (summaryData.adminFee || summaryData.AdminFee || '0.00'), 15, yPos);
                
                // === INCOME SECTION ===
                yPos += 12;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Income', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Gross Sales', 20, yPos);
                doc.text('â‚±' + (data.income?.grossSales || data.income?.GrossSales || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.text('Less: Returns', 20, yPos);
                doc.text('â‚±' + (data.income?.returns || data.income?.Returns || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.setFont('helvetica', 'bold');
                doc.text('Net Sales', 20, yPos);
                doc.text('â‚±' + (data.income?.netSales || data.income?.NetSales || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                
                // === EXPENSES TABLE ===
                yPos += 12;
                checkNewPage(50);
                
                let expenseData = [];
                if (data.expenses && Array.isArray(data.expenses) && data.expenses.length > 0) {
                    expenseData = data.expenses.map(e => {
                        try {
                            const amount = String(e.amount || e.Amount || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                            return [
                                e.type || e.Type || '',
                                'â‚±' + parseFloat(amount || 0).toFixed(2)
                            ];
                        } catch (err) {
                            console.error('Error processing expense row:', err, e);
                            return [e.type || e.Type || 'Unknown', 'â‚±0.00'];
                        }
                    });
                } else {
                    expenseData = [['No expenses found', 'â‚±0.00']];
                }
                
                // Add total row
                expenseData.push(['Total Expenses', 'â‚±' + (data.summary?.totalExpenses || data.summary?.TotalExpenses || '0.00')]);
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Expense Type', 'Amount']],
                    body: expenseData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto', halign: 'right' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NET PROFIT / LOSS ===
                checkNewPage(30);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(10);
                const netProfitStr = String(summaryData.netProfit || summaryData.NetProfit || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                const netProfit = parseFloat(netProfitStr) || 0;
                // Set text color - green for profit, red for loss
                // jsPDF setTextColor expects RGB as separate arguments, not an array
                if (!isNaN(netProfit) && isFinite(netProfit)) {
                    if (netProfit >= 0) {
                        doc.setTextColor(40, 167, 69); // Green for profit
                    } else {
                        doc.setTextColor(220, 53, 69); // Red for loss
                    }
                } else {
                    doc.setTextColor(30, 58, 95); // Default dark blue if parsing fails
                }
                doc.text('Net Profit / (Loss): â‚±' + (summaryData.netProfit || summaryData.NetProfit || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                
                // === NOTHING FOLLOWS ===
                yPos += 12;
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: P&L-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Profit_Loss_Statement_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating Profit & Loss PDF:', error);
                console.error('Data received:', data);
                alert('Failed to generate PDF. Please check the browser console for details.');
            }
        };

        // Function to generate and print Tax Reports PDF (Accounting) - New format
        window.printTaxReports = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Tax Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = data.dateRange || 'All Time';
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Accounting'), 15, yPos);
                doc.text('Date: ' + (data.printedAt || ''), pageWidth - 15, yPos, { align: 'right' });
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(50);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Tax Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Sales (Before Tax): â‚±' + (data.summary.totalSalesBeforeTax || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('VAT (12%): â‚±' + (data.summary.vatAmount || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Admin Fee (2%): â‚±' + (data.summary.adminFeeAmount || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Tax & Fees: â‚±' + (data.summary.totalTaxAndFees || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Products Sold: ' + (data.summary.totalProductsSold || '0'), 15, yPos);
                yPos += 5;
                doc.text('Total Product Revenue: â‚±' + (data.summary.totalProductRevenue || '0.00'), 15, yPos);
                
                // === VAT BREAKDOWN ===
                yPos += 12;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('VAT Breakdown (12% on Sales)', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Sales (Before Tax)', 20, yPos);
                doc.text('â‚±' + (data.vatBreakdown.totalSales || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.text('VAT Rate', 20, yPos);
                doc.text(data.vatBreakdown.rate || '12%', pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.setFont('helvetica', 'bold');
                doc.text('VAT Amount', 20, yPos);
                doc.text('â‚±' + (data.vatBreakdown.amount || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                
                // === ADMIN FEE BREAKDOWN ===
                yPos += 12;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Admin Fee Breakdown (2% per Product)', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Products Sold', 20, yPos);
                doc.text(data.adminFeeBreakdown.totalProductsSold || '0', pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.text('Total Product Revenue', 20, yPos);
                doc.text('â‚±' + (data.adminFeeBreakdown.totalRevenue || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.text('Admin Fee Rate', 20, yPos);
                doc.text(data.adminFeeBreakdown.rate || '2%', pageWidth - 15, yPos, { align: 'right' });
                yPos += 5;
                doc.setFont('helvetica', 'bold');
                doc.text('Admin Fee Amount', 20, yPos);
                doc.text('â‚±' + (data.adminFeeBreakdown.amount || '0.00'), pageWidth - 15, yPos, { align: 'right' });
                
                // === PRODUCT-LEVEL ADMIN FEE TABLE ===
                yPos += 12;
                checkNewPage(50);
                
                const productData = data.products && data.products.length > 0
                    ? data.products.map(p => {
                        const revenue = String(p.totalRevenue || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        const adminFee = String(p.adminFee || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            (p.productName || '') + ' - ' + (p.variantName || ''),
                            (p.quantitySold || '0'),
                            'â‚±' + parseFloat(revenue || 0).toFixed(2),
                            'â‚±' + parseFloat(adminFee || 0).toFixed(2)
                        ];
                    })
                    : [['No products found', '0', 'â‚±0.00', 'â‚±0.00']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Product', 'Quantity Sold', 'Total Revenue', 'Admin Fee (2%)']],
                    body: productData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto', halign: 'right' },
                        2: { cellWidth: 'auto', halign: 'right' },
                        3: { cellWidth: 'auto', halign: 'right' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: TAX-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Tax_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print returns report PDF
        // Function to generate and print dashboard PDF
        window.generateAndPrintDashboard = function(dashboardData, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                let yPos = 20;

                // Header
                doc.setFontSize(20);
                doc.setTextColor(48, 77, 109); // YInMn Blue
                doc.text('Dashboard Report', 14, yPos);
                yPos += 10;

                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, yPos);
                yPos += 6;
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, yPos);
                yPos += 6;
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, yPos);
                yPos += 12;

                // Summary Cards Section
                doc.setFontSize(14);
                doc.setTextColor(48, 77, 109);
                doc.text('Summary Statistics', 14, yPos);
                yPos += 8;

                doc.setFontSize(9);
                doc.setTextColor(45, 45, 45);
                
                // Create summary table
                const summaryData = [
                    ['Metric', 'Value'],
                    ['Total Sales', dashboardData.stats.totalSales.toString()],
                    ['Total Revenue', `â‚±${dashboardData.stats.totalRevenue.toFixed(2)}`],
                    ['Total Returns', dashboardData.stats.totalReturns.toString()],
                    ['Today\'s Sales', dashboardData.stats.todaySales.toString()],
                    ['Today\'s Revenue', `â‚±${dashboardData.stats.todayRevenue.toFixed(2)}`],
                    ['Today\'s Returns', dashboardData.stats.todayReturns.toString()],
                    ['Net Sales', (dashboardData.stats.totalSales - dashboardData.stats.totalReturns).toString()],
                    ['Avg Daily Revenue', `â‚±${(dashboardData.stats.totalRevenue / Math.max(1, dashboardData.days)).toFixed(2)}`]
                ];

                doc.autoTable({
                    startY: yPos,
                    head: [summaryData[0]],
                    body: summaryData.slice(1),
                    theme: 'striped',
                    headStyles: {
                        fillColor: [144, 238, 145],
                        textColor: [15, 63, 17],
                        fontStyle: 'bold'
                    },
                    styles: {
                        fontSize: 9,
                        cellPadding: 4,
                        textColor: [45, 45, 45]
                    },
                    columnStyles: {
                        0: { cellWidth: 60, fontStyle: 'bold' },
                        1: { cellWidth: 40, halign: 'right' }
                    }
                });

                yPos = doc.autoTable.previous.finalY + 12;

                // Check if we need a new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                // Sales Trend Data
                if (dashboardData.salesData && dashboardData.salesData.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(48, 77, 109);
                    doc.text('Sales Trend (Last ' + dashboardData.days + ' Days)', 14, yPos);
                    yPos += 8;

                    const salesTableData = dashboardData.salesData.map(item => [
                        new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                        item.count.toString(),
                        `â‚±${item.revenue.toFixed(2)}`
                    ]);

                    doc.autoTable({
                        startY: yPos,
                        head: [['Date', 'Sales Count', 'Revenue']],
                        body: salesTableData,
                        theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                        styles: {
                            fontSize: 8,
                            cellPadding: 3,
                            textColor: [45, 45, 45]
                        },
                        columnStyles: {
                            0: { cellWidth: 50 },
                            1: { cellWidth: 40, halign: 'center' },
                            2: { cellWidth: 50, halign: 'right' }
                        }
                    });

                    yPos = doc.autoTable.previous.finalY + 12;
                }

                // Check if we need a new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                // Returns Trend Data
                if (dashboardData.returnsData && dashboardData.returnsData.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(48, 77, 109);
                    doc.text('Returns Trend (Last ' + dashboardData.days + ' Days)', 14, yPos);
                    yPos += 8;

                    const returnsTableData = dashboardData.returnsData
                        .filter(item => item.count > 0)
                        .map(item => [
                            new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                            item.count.toString()
                        ]);

                    if (returnsTableData.length > 0) {
                        doc.autoTable({
                            startY: yPos,
                            head: [['Date', 'Returns Count']],
                            body: returnsTableData,
                            theme: 'striped',
                            headStyles: {
                                fillColor: [162, 185, 205],
                                textColor: [48, 77, 109],
                                fontStyle: 'bold'
                            },
                            styles: {
                                fontSize: 8,
                                cellPadding: 3,
                                textColor: [45, 45, 45]
                            },
                            columnStyles: {
                                0: { cellWidth: 70 },
                                1: { cellWidth: 70, halign: 'center' }
                            }
                        });

                        yPos = doc.autoTable.previous.finalY + 12;
                    } else {
                        doc.setFontSize(9);
                        doc.setTextColor(100, 100, 100);
                        doc.text('No returns data available', 14, yPos);
                        yPos += 10;
                    }
                }

                // Check if we need a new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                // Top Selling Products
                if (dashboardData.topProducts && dashboardData.topProducts.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(48, 77, 109);
                    doc.text('Top Selling Products', 14, yPos);
                    yPos += 8;

                    const productsTableData = dashboardData.topProducts.map((product, index) => [
                        (index + 1).toString(),
                        product.productName + ' - ' + product.variantName,
                        product.totalQuantity.toString(),
                        `â‚±${product.totalRevenue.toFixed(2)}`,
                        product.saleCount.toString()
                    ]);

                    doc.autoTable({
                        startY: yPos,
                        head: [['Rank', 'Product', 'Qty Sold', 'Revenue', 'Sales']],
                        body: productsTableData,
                        theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                        styles: {
                            fontSize: 8,
                            cellPadding: 3,
                            textColor: [45, 45, 45]
                        },
                        columnStyles: {
                            0: { cellWidth: 15, halign: 'center' },
                            1: { cellWidth: 70 },
                            2: { cellWidth: 25, halign: 'center' },
                            3: { cellWidth: 35, halign: 'right' },
                            4: { cellWidth: 25, halign: 'center' }
                        }
                    });

                    yPos = doc.autoTable.previous.finalY + 12;
                }

                // Check if we need a new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                // Payment Method Breakdown
                if (dashboardData.paymentMethods && dashboardData.paymentMethods.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(48, 77, 109);
                    doc.text('Payment Method Breakdown', 14, yPos);
                    yPos += 8;

                    const paymentTableData = dashboardData.paymentMethods.map(method => [
                        method.paymentMethod,
                        method.count.toString(),
                        `â‚±${method.totalAmount.toFixed(2)}`,
                        `${method.percentage.toFixed(1)}%`
                    ]);

                    doc.autoTable({
                        startY: yPos,
                        head: [['Method', 'Count', 'Total Amount', 'Percentage']],
                        body: paymentTableData,
                        theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                        styles: {
                            fontSize: 8,
                            cellPadding: 3,
                            textColor: [45, 45, 45]
                        },
                        columnStyles: {
                            0: { cellWidth: 40 },
                            1: { cellWidth: 30, halign: 'center' },
                            2: { cellWidth: 40, halign: 'right' },
                            3: { cellWidth: 30, halign: 'right' }
                        }
                    });

                    yPos = doc.autoTable.previous.finalY + 12;
                }

                // Check if we need a new page
                if (yPos > 250) {
                    doc.addPage();
                    yPos = 20;
                }

                // Customer Order Table
                if (dashboardData.recentTransactions && dashboardData.recentTransactions.length > 0) {
                    doc.setFontSize(14);
                    doc.setTextColor(48, 77, 109);
                    doc.text('Customer Order', 14, yPos);
                    yPos += 6;
                    doc.setFontSize(9);
                    doc.setTextColor(100, 100, 100);
                    doc.text('Recent sales transactions', 14, yPos);
                    yPos += 8;

                    // Helper function to get initials from sale number
                    const getInitials = (saleNumber) => {
                        if (!saleNumber || saleNumber.length === 0) return 'U';
                        return saleNumber.length >= 2 
                            ? saleNumber.substring(0, 2).toUpperCase() 
                            : saleNumber[0].toUpperCase();
                    };

                    const customerOrderTableData = dashboardData.recentTransactions.map(trans => [
                        getInitials(trans.saleNumber),
                        trans.saleNumber,
                        new Date(trans.timestamps).toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric', 
                            year: 'numeric'
                        }),
                        trans.paymentMethod,
                        `â‚±${trans.amount.toFixed(2)}`
                    ]);

                    doc.autoTable({
                        startY: yPos,
                        head: [['Profile', 'Sale Number', 'Date', 'Status', 'Price']],
                        body: customerOrderTableData,
                        theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                        styles: {
                            fontSize: 8,
                            cellPadding: 3,
                            textColor: [45, 45, 45]
                        },
                        columnStyles: {
                            0: { cellWidth: 25, halign: 'center' },
                            1: { cellWidth: 45, fontStyle: 'bold' },
                            2: { cellWidth: 50 },
                            3: { cellWidth: 40 },
                            4: { cellWidth: 35, halign: 'right', fontStyle: 'bold' }
                        }
                    });

                    yPos = doc.autoTable.previous.finalY + 12;
                }

                // Performance Insights
                if (dashboardData.averageTransactionValue > 0 || dashboardData.hourlySalesData) {
                    doc.setFontSize(14);
                    doc.setTextColor(48, 77, 109);
                    doc.text('Performance Insights', 14, yPos);
                    yPos += 8;

                    const insights = [];
                    if (dashboardData.averageTransactionValue > 0) {
                        insights.push(['Average Transaction Value', `â‚±${dashboardData.averageTransactionValue.toFixed(2)}`]);
                    }
                    
                    if (dashboardData.hourlySalesData && dashboardData.hourlySalesData.length > 0) {
                        const bestHour = dashboardData.hourlySalesData.reduce((max, item) => 
                            item.count > max.count ? item : max, dashboardData.hourlySalesData[0]);
                        insights.push(['Best Sales Hour', `${bestHour.hour}:00 (${bestHour.count} sales)`]);
                    }

                    if (dashboardData.topProducts && dashboardData.topProducts.length > 0) {
                        insights.push(['Top Product', dashboardData.topProducts[0].productName + ' - ' + dashboardData.topProducts[0].variantName]);
                    }

                    if (dashboardData.paymentMethods && dashboardData.paymentMethods.length > 0) {
                        const preferred = dashboardData.paymentMethods.reduce((max, item) => 
                            item.count > max.count ? item : max, dashboardData.paymentMethods[0]);
                        insights.push(['Preferred Payment', preferred.paymentMethod]);
                    }

                    if (insights.length > 0) {
                        doc.autoTable({
                            startY: yPos,
                            head: [['Metric', 'Value']],
                            body: insights,
                            theme: 'striped',
                            headStyles: {
                                fillColor: [162, 185, 205],
                                textColor: [48, 77, 109],
                                fontStyle: 'bold'
                            },
                            styles: {
                                fontSize: 9,
                                cellPadding: 4,
                                textColor: [45, 45, 45]
                            },
                            columnStyles: {
                                0: { cellWidth: 80, fontStyle: 'bold' },
                                1: { cellWidth: 60 }
                            }
                        });
                    }
                }

                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }

                // Generate PDF blob
                const pdfBlob = doc.output('blob');

                // Download PDF
                doc.save('Dashboard_Report.pdf');

                // Open PDF in new window for printing
                const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl);

                if (printWindow) {
                    // Wait for PDF to load, then trigger print
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        // Clean up the object URL after printing
                        setTimeout(() => {
                            URL.revokeObjectURL(pdfUrl);
                        }, 1000);
                    }, 1000);
                } else {
                    // If popup blocked, try alternative method
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.target = '_blank';
                    link.click();
                }
            } catch (error) {
                console.error('Error generating Dashboard PDF:', error);
                alert('Error generating Dashboard PDF. Please try again.');
            }
        };

        window.generateAndPrintReturnsReport = function(data, portal) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Returns Reports (All Cashiers)', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const portalText = portal || 'Seller Portal';
                doc.text(portalText + ' â€¢ ' + (data.dateRange || 'All Time'), pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Seller'), 15, yPos);
                doc.text('Date: ' + (data.printedAt || new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                })), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Returns: ' + (data.totalCount || 0), 15, yPos + 5);

                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(30);

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);

                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Returns Amount: â‚±' + (data.totalReturnsAmount || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Pending Returns: ' + (data.pendingReturnsCount || 0), 15, yPos);
                yPos += 5;
                doc.text('Completed Returns: ' + (data.completedReturnsCount || 0), 15, yPos);

                // === RETURNS TABLE ===
                yPos += 10;
                checkNewPage(50);

                const returnsData = data.records && data.records.length > 0
                    ? data.records.map(returnItem => [
                        returnItem.returnNumber || '',
                        returnItem.saleNumber || '',
                        returnItem.status || '',
                        returnItem.cashierName || '',
                        `${returnItem.date || ''} ${returnItem.time || ''}`
                    ])
                    : [['No returns found', '', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['Return Number', 'Sale Number', 'Status', 'Cashier', 'Date']],
                    body: returnsData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 40 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 30 },
                        3: { cellWidth: 40 },
                        4: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: RET-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Returns_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print stock in report PDF
        // Function to generate and print stock in report PDF - Professional Format matching Sales Report
        window.generateAndPrintStockInReport = function(stockIns, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values from stock in data
                const totalQuantity = stockIns.reduce((sum, si) => {
                    const qty = parseInt(si.quantity || 0);
                    return sum + qty;
                }, 0);
                const totalCost = stockIns.reduce((sum, si) => {
                    const cost = parseFloat(String(si.totalCost || 0).replace(/â‚±/g, '').replace(/,/g, '').trim() || 0);
                    return sum + cost;
                }, 0);
                const avgCostPerItem = totalQuantity > 0 ? totalCost / totalQuantity : 0;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Stock In Reports', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Stock Clerk Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Seller'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + (stockIns ? stockIns.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(30);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Quantity In: ' + totalQuantity, 15, yPos);
                yPos += 5;
                doc.text('Total Cost: â‚±' + totalCost.toFixed(2), 15, yPos);
                yPos += 5;
                doc.text('Average Cost per Item: â‚±' + avgCostPerItem.toFixed(2), 15, yPos);
                
                // === STOCK IN TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const stockInData = stockIns && stockIns.length > 0
                    ? stockIns.map(si => {
                        const costPrice = parseFloat(String(si.costPrice || 0).replace(/â‚±/g, '').replace(/,/g, '').trim() || 0);
                        const totalCost = parseFloat(String(si.totalCost || 0).replace(/â‚±/g, '').replace(/,/g, '').trim() || 0);
                        return [
                            si.productName || '',
                            si.variantName || '',
                            (si.quantity || 0).toString(),
                            'â‚±' + costPrice.toFixed(2),
                            'â‚±' + totalCost.toFixed(2),
                            si.supplierName || 'N/A',
                            si.stockClerkName || 'N/A',
                            `${si.date || ''} ${si.time || ''}`
                        ];
                    })
                    : [['No stock in records found', '', '', '', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Product', 'Variant', 'Quantity', 'Cost Price', 'Total Cost', 'Supplier', 'Stock Clerk', 'Date']],
                    body: stockInData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 30 },
                        1: { cellWidth: 25 },
                        2: { cellWidth: 18, halign: 'center' },
                        3: { cellWidth: 22, halign: 'right' },
                        4: { cellWidth: 22, halign: 'right' },
                        5: { cellWidth: 25 },
                        6: { cellWidth: 25 },
                        7: { cellWidth: 23 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: STKIN-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Stock_In_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print stock out report PDF - Professional Format matching Sales Report
        window.generateAndPrintStockOutReport = function(stockOuts, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values from stock out data
                const totalQuantity = stockOuts.reduce((sum, so) => sum + parseInt(so.quantity || 0), 0);
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Stock Out Reports', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Stock Clerk Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Seller'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + (stockOuts ? stockOuts.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(30);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Records: ' + (stockOuts ? stockOuts.length : 0), 15, yPos);
                yPos += 5;
                doc.text('Total Quantity Removed: ' + totalQuantity, 15, yPos);
                
                // === STOCK OUT TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const stockOutData = stockOuts && stockOuts.length > 0
                    ? stockOuts.map(so => [
                        so.productName || '',
                        so.variantName || '',
                        (so.quantity || 0).toString(),
                        so.reason || 'N/A',
                        so.stockClerkName || so.userName || 'N/A',
                        `${so.date || ''} ${so.time || ''}`
                    ])
                    : [['No stock out records found', '', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Product', 'Variant', 'Quantity', 'Reason', 'Stock Clerk', 'Date']],
                    body: stockOutData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 35 },
                        1: { cellWidth: 30 },
                        2: { cellWidth: 20, halign: 'right' },
                        3: { cellWidth: 35 },
                        4: { cellWidth: 30 },
                        5: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: STO-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Stock_Out_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print stock adjustment report PDF - Professional Format matching Sales Report
        window.generateAndPrintStockAdjustmentReport = function(adjustments, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values from adjustments data
                const increaseTotal = adjustments.filter(sa => sa.adjustmentType === 'Increase')
                    .reduce((sum, sa) => sum + parseInt(sa.quantity || 0), 0);
                const decreaseTotal = adjustments.filter(sa => sa.adjustmentType === 'Decrease')
                    .reduce((sum, sa) => sum + parseInt(sa.quantity || 0), 0);
                const netAdjustment = increaseTotal - decreaseTotal;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Stock Adjustment Reports', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Stock Clerk Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Seller'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + (adjustments ? adjustments.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Records: ' + (adjustments ? adjustments.length : 0), 15, yPos);
                yPos += 5;
                doc.text('Total Increases: ' + increaseTotal, 15, yPos);
                yPos += 5;
                doc.text('Total Decreases: ' + decreaseTotal, 15, yPos);
                yPos += 5;
                doc.text('Net Adjustment: ' + netAdjustment, 15, yPos);
                
                // === ADJUSTMENTS TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const adjustmentsData = adjustments && adjustments.length > 0
                    ? adjustments.map(sa => [
                        sa.productName || '',
                        sa.variantName || '',
                        sa.adjustmentType || '',
                        (sa.quantity || 0).toString(),
                        sa.reason || 'N/A',
                        sa.userName || 'N/A',
                        `${sa.date || ''} ${sa.time || ''}`
                    ])
                    : [['No adjustments found', '', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['Product', 'Variant', 'Type', 'Quantity', 'Reason', 'Recorded By', 'Date']],
                    body: adjustmentsData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 30 },
                        1: { cellWidth: 25 },
                        2: { cellWidth: 20 },
                        3: { cellWidth: 18, halign: 'right' },
                        4: { cellWidth: 30 },
                        5: { cellWidth: 28 },
                        6: { cellWidth: 29 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: STKADJ-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Stock_Adjustment_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
            } catch (error) {
                console.error('Error generating PDF:', error);
                window.print();
            }
        };

        // Function to generate and print inventory report
        window.generateAndPrintInventoryReport = function(inventories, userName, reportDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values
                const totalItems = inventories.length;
                const inStockCount = inventories.filter(inv => inv.status === 'In Stock').length;
                const lowStockCount = inventories.filter(inv => inv.status === 'Low Stock').length;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(16);
                doc.setTextColor(30, 58, 95);
                doc.text('INVENTORY REPORT', pageWidth / 2, yPos + 8, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + userName, 20, yPos + 15);
                doc.text('Report Date: ' + reportDate, pageWidth - 20, yPos + 15, { align: 'right' });
                doc.text('Total Items: ' + totalItems, 20, yPos + 21);
                
                yPos += 30;
                
                // === SUMMARY SECTION ===
                checkNewPage(25);
                doc.setFillColor(249, 250, 251);
                doc.roundedRect(15, yPos, pageWidth - 30, 20, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(10);
                doc.setTextColor(30, 58, 95);
                doc.text('SUMMARY', 20, yPos + 7);
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(9);
                doc.setTextColor(75, 85, 99);
                doc.text('In Stock: ' + inStockCount, 20, yPos + 14);
                doc.text('Low Stock: ' + lowStockCount, pageWidth / 2, yPos + 14);
                doc.text('Total Items: ' + totalItems, pageWidth - 20, yPos + 14, { align: 'right' });
                
                yPos += 25;
                
                // === INVENTORY TABLE ===
                checkNewPage(15);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(10);
                doc.setTextColor(30, 58, 95);
                doc.text('INVENTORY LIST', 20, yPos);
                yPos += 8;
                
                const tableData = inventories.map(inv => [
                    inv.productName || 'N/A',
                    inv.variantName || 'N/A',
                    inv.sizeName || 'N/A',
                    inv.colorName || 'N/A',
                    inv.currentStock?.toString() || '0',
                    inv.reorderLevel?.toString() || '0',
                    inv.status || 'N/A'
                ]);
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Product', 'Variant', 'Size', 'Color', 'Current Stock', 'Reorder Level', 'Status']],
                    body: tableData,
                    theme: 'striped',
                    headStyles: {
                        fillColor: [30, 58, 95],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold',
                        fontSize: 8
                    },
                    bodyStyles: {
                        fontSize: 7,
                        textColor: [31, 41, 55]
                    },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto' },
                        4: { cellWidth: 'auto', halign: 'center' },
                        5: { cellWidth: 'auto', halign: 'center' },
                        6: { cellWidth: 'auto', halign: 'center' }
                    },
                    margin: { left: 15, right: 15 },
                    styles: {
                        cellPadding: 2,
                        overflow: 'linebreak'
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === FOOTER ===
                checkNewPage(20);
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('--- Nothing Follows ---', pageWidth / 2, yPos, { align: 'center' });
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(6);
                doc.text('This is a computer-generated report. No signature required.', pageWidth / 2, yPos, { align: 'center' });
                
                yPos += 5;
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Inventory_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
            } catch (error) {
                console.error('Error generating PDF:', error);
                window.print();
            }
        };

        // Function to print stock in receipt
        window.printStockInReceipt = function(receiptData) {
            try {
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Please allow popups to print the receipt.');
                    return;
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Stock In Receipt - ${receiptData.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .header h1 { margin: 0; font-size: 20px; }
                            .info { margin: 10px 0; }
                            .label { font-weight: bold; }
                            .divider { border-top: 1px solid #000; margin: 15px 0; }
                            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>STOCK IN RECEIPT</h1>
                            <p>ID: ${receiptData.id}</p>
                        </div>
                        <div class="info"><span class="label">Product:</span> ${receiptData.productName}</div>
                        <div class="info"><span class="label">Variant:</span> ${receiptData.variantName}</div>
                        ${receiptData.sizeName ? `<div class="info"><span class="label">Size:</span> ${receiptData.sizeName}</div>` : ''}
                        ${receiptData.colorName ? `<div class="info"><span class="label">Color:</span> ${receiptData.colorName}</div>` : ''}
                        <div class="info"><span class="label">Quantity Added:</span> ${receiptData.quantityAdded}</div>
                        <div class="info"><span class="label">Cost Price:</span> â‚±${parseFloat(receiptData.costPrice || 0).toFixed(2)}</div>
                        <div class="info"><span class="label">Total Cost:</span> â‚±${parseFloat(receiptData.totalCost || 0).toFixed(2)}</div>
                        <div class="divider"></div>
                        ${receiptData.supplierName ? `<div class="info"><span class="label">Supplier:</span> ${receiptData.supplierName}</div>` : ''}
                        ${receiptData.supplierContactPerson ? `<div class="info"><span class="label">Contact Person:</span> ${receiptData.supplierContactPerson}</div>` : ''}
                        ${receiptData.supplierEmail ? `<div class="info"><span class="label">Email:</span> ${receiptData.supplierEmail}</div>` : ''}
                        ${receiptData.supplierContactNumber ? `<div class="info"><span class="label">Contact:</span> ${receiptData.supplierContactNumber}</div>` : ''}
                        <div class="divider"></div>
                        <div class="info"><span class="label">Date:</span> ${receiptData.dateTime}</div>
                        <div class="info"><span class="label">Recorded By:</span> ${receiptData.userName}</div>
                        <div class="footer">
                            <p>Thank you for using SoftWear Inventory System</p>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                }, 250);
            } catch (error) {
                console.error('Error printing receipt:', error);
                alert('Failed to print receipt. Please try again.');
            }
        };

        // Function to print stock out receipt
        window.printStockOutReceipt = function(receiptData) {
            try {
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Please allow popups to print the receipt.');
                    return;
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Stock Out Receipt - ${receiptData.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .header h1 { margin: 0; font-size: 20px; }
                            .info { margin: 10px 0; }
                            .label { font-weight: bold; }
                            .divider { border-top: 1px solid #000; margin: 15px 0; }
                            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>STOCK OUT RECEIPT</h1>
                            <p>ID: ${receiptData.id}</p>
                        </div>
                        <div class="info"><span class="label">Product:</span> ${receiptData.productName}</div>
                        <div class="info"><span class="label">Variant:</span> ${receiptData.variantName}</div>
                        ${receiptData.sizeName ? `<div class="info"><span class="label">Size:</span> ${receiptData.sizeName}</div>` : ''}
                        ${receiptData.colorName ? `<div class="info"><span class="label">Color:</span> ${receiptData.colorName}</div>` : ''}
                        <div class="info"><span class="label">Quantity Removed:</span> ${receiptData.quantityRemoved}</div>
                        ${receiptData.reason ? `<div class="info"><span class="label">Reason:</span> ${receiptData.reason}</div>` : ''}
                        <div class="divider"></div>
                        <div class="info"><span class="label">Date:</span> ${receiptData.dateTime}</div>
                        <div class="info"><span class="label">Recorded By:</span> ${receiptData.userName}</div>
                        <div class="footer">
                            <p>Thank you for using SoftWear Inventory System</p>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                }, 250);
            } catch (error) {
                console.error('Error printing receipt:', error);
                alert('Failed to print receipt. Please try again.');
            }
        };

        // Function to print stock adjustment receipt
        window.printStockAdjustmentReceipt = function(receiptData) {
            try {
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Please allow popups to print the receipt.');
                    return;
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Stock Adjustment Receipt - ${receiptData.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .header h1 { margin: 0; font-size: 20px; }
                            .info { margin: 10px 0; }
                            .label { font-weight: bold; }
                            .divider { border-top: 1px solid #000; margin: 15px 0; }
                            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>STOCK ADJUSTMENT RECEIPT</h1>
                            <p>ID: ${receiptData.id}</p>
                        </div>
                        <div class="info"><span class="label">Product:</span> ${receiptData.productName}</div>
                        <div class="info"><span class="label">Variant:</span> ${receiptData.variantName}</div>
                        ${receiptData.sizeName ? `<div class="info"><span class="label">Size:</span> ${receiptData.sizeName}</div>` : ''}
                        ${receiptData.colorName ? `<div class="info"><span class="label">Color:</span> ${receiptData.colorName}</div>` : ''}
                        <div class="info"><span class="label">Adjustment Type:</span> ${receiptData.adjustmentType}</div>
                        <div class="info"><span class="label">Quantity Adjusted:</span> ${receiptData.quantityAdjusted}</div>
                        ${receiptData.reason ? `<div class="info"><span class="label">Reason:</span> ${receiptData.reason}</div>` : ''}
                        <div class="divider"></div>
                        <div class="info"><span class="label">Date:</span> ${receiptData.dateTime}</div>
                        <div class="info"><span class="label">Recorded By:</span> ${receiptData.userName}</div>
                        <div class="footer">
                            <p>Thank you for using SoftWear Inventory System</p>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                }, 250);
            } catch (error) {
                console.error('Error printing receipt:', error);
                alert('Failed to print receipt. Please try again.');
            }
        };

        // Function to generate and print receipt (HTML-based)
        window.printReceipt = function(receiptData) {
            try {
                // Build items HTML
                let itemsHtml = '';
                receiptData.items.forEach(item => {
                    const details = [];
                    if (item.sizeName) details.push(`Size: ${item.sizeName}`);
                    if (item.colorName) details.push(`Color: ${item.colorName}`);
                    
                    const detailsHtml = details.length > 0 ? '<div class="item-details">' + details.join(', ') + '</div>' : '';
                    itemsHtml += '<tr>' +
                        '<td class="item-name">' +
                        '<div>' + item.productName + ' - ' + item.variantName + '</div>' +
                        detailsHtml +
                        '</td>' +
                        '<td class="item-qty">' + item.quantity + '</td>' +
                        '<td class="item-price">â‚±' + item.subtotal.toFixed(2) + '</td>' +
                        '</tr>';
                });
                
                // Build payment info HTML
                let paymentInfoHtml = '';
                if (receiptData.paymentMethod === 'Cash' && receiptData.changeGiven > 0) {
                    paymentInfoHtml += `<div class="receipt-row"><span>Change:</span><span>â‚±${receiptData.changeGiven.toFixed(2)}</span></div>`;
                }
                if (receiptData.paymentMethod === 'GCash' && receiptData.referenceNumber) {
                    paymentInfoHtml += `<div class="receipt-row"><span>Ref #:</span><span>${receiptData.referenceNumber}</span></div>`;
                }
                
                // Create HTML receipt
                const receiptHtml = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Receipt - ${receiptData.saleNumber}</title>
                        <style>
                            @media print {
                                @page {
                                    size: 80mm auto;
                                    margin: 5mm;
                                }
                                body {
                                    margin: 0;
                                    padding: 0;
                                }
                                .no-print {
                                    display: none;
                                }
                            }
                            * {
                                margin: 0;
                                padding: 0;
                                box-sizing: border-box;
                            }
                            body {
                                font-family: 'Courier New', monospace;
                                font-size: 12px;
                                width: 70mm;
                                margin: 0 auto;
                                padding: 10px;
                                background: white;
                            }
                            .receipt-header {
                                text-align: center;
                                margin-bottom: 15px;
                            }
                            .store-name {
                                font-size: 18px;
                                font-weight: bold;
                                margin-bottom: 5px;
                            }
                            .thank-you {
                                font-size: 10px;
                                color: #666;
                                margin-bottom: 10px;
                            }
                            .divider {
                                border-top: 1px dashed #ccc;
                                margin: 10px 0;
                            }
                            .receipt-info {
                                margin-bottom: 10px;
                                font-size: 11px;
                            }
                            .receipt-info div {
                                margin: 3px 0;
                            }
                            .items-table {
                                width: 100%;
                                margin: 10px 0;
                                border-collapse: collapse;
                            }
                            .items-table th {
                                text-align: left;
                                font-size: 10px;
                                padding: 5px 0;
                                border-bottom: 1px dashed #ccc;
                            }
                            .items-table td {
                                padding: 5px 0;
                                font-size: 10px;
                            }
                            .item-name {
                                width: 60%;
                            }
                            .item-qty {
                                width: 15%;
                                text-align: center;
                            }
                            .item-price {
                                width: 25%;
                                text-align: right;
                            }
                            .item-details {
                                font-size: 9px;
                                color: #666;
                                margin-top: 2px;
                            }
                            .receipt-total {
                                margin: 10px 0;
                                font-size: 12px;
                                font-weight: bold;
                                text-align: right;
                            }
                            .receipt-row {
                                display: flex;
                                justify-content: space-between;
                                margin: 5px 0;
                                font-size: 10px;
                            }
                            .receipt-footer {
                                text-align: center;
                                margin-top: 15px;
                                font-size: 10px;
                                color: #666;
                            }
                            .print-button {
                                position: fixed;
                                top: 10px;
                                right: 10px;
                                padding: 10px 20px;
                                background: #304D6D;
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 14px;
                            }
                            .print-button:hover {
                                background: #1e3a52;
                            }
                        </style>
                    </head>
                    <body>
                        <button class="print-button no-print" onclick="window.print()">Print Receipt</button>
                        
                        <div class="receipt-header">
                            <div class="store-name">SoftWear Store</div>
                            <div class="thank-you">Thank you for your purchase!</div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="receipt-info">
                            <div><strong>Sale #:</strong> ${receiptData.saleNumber}</div>
                            <div><strong>Date:</strong> ${receiptData.dateTime}</div>
                            <div><strong>Cashier:</strong> ${receiptData.cashierName}</div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th class="item-qty">Qty</th>
                                    <th class="item-price">Price</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHtml}
                            </tbody>
                        </table>
                        
                        <div class="divider"></div>
                        
                        <div class="receipt-total">
                            Total: â‚±${receiptData.totalAmount.toFixed(2)}
                        </div>
                        
                        <div class="receipt-row">
                            <span><strong>Payment Method:</strong></span>
                            <span>${receiptData.paymentMethod}</span>
                        </div>
                        <div class="receipt-row">
                            <span><strong>Amount Paid:</strong></span>
                            <span>â‚±${receiptData.amountPaid.toFixed(2)}</span>
                        </div>
                        ${paymentInfoHtml}
                        
                        <div class="divider"></div>
                        
                        <div class="receipt-footer">
                            <div>Thank you for shopping with us!</div>
                            <div>Please come again!</div>
                        </div>
                    </body>
                    </html>
                `;
                
                // Use iframe method (works best with MAUI Blazor WebView)
                const printFrame = document.createElement('iframe');
                printFrame.name = 'receiptPrintFrame';
                printFrame.style.position = 'fixed';
                printFrame.style.right = '0';
                printFrame.style.bottom = '0';
                printFrame.style.width = '1px';
                printFrame.style.height = '1px';
                printFrame.style.border = 'none';
                printFrame.style.opacity = '0.01';
                printFrame.style.pointerEvents = 'none';
                
                document.body.appendChild(printFrame);
                
                // Write HTML directly to iframe (no data URI needed)
                const printDoc = printFrame.contentDocument || printFrame.contentWindow.document;
                printDoc.open();
                printDoc.write(receiptHtml);
                printDoc.close();
                
                // Wait for iframe to load, then print
                setTimeout(function() {
                    try {
                        if (printFrame.contentWindow && printFrame.contentWindow.document.readyState === 'complete') {
                            printFrame.contentWindow.focus();
                            printFrame.contentWindow.print();
                        } else {
                            // If not ready, wait a bit more
                            printFrame.onload = function() {
                                setTimeout(function() {
                                    try {
                                        printFrame.contentWindow.focus();
                                        printFrame.contentWindow.print();
                                    } catch (e) {
                                        console.error('Error printing:', e);
                                        alert('Receipt ready! Please use Ctrl+P or the Print button to print.');
                                    }
                                }, 500);
                            };
                        }
                    } catch (e) {
                        console.error('Error printing from iframe:', e);
                        alert('Receipt ready! Please use Ctrl+P to print.');
                    }
                    
                    // Clean up iframe after printing
                    setTimeout(function() {
                        if (document.body.contains(printFrame)) {
                            document.body.removeChild(printFrame);
                        }
                    }, 3000);
                }, 1000);
            } catch (error) {
                console.error('Error generating receipt:', error);
                alert('Error generating receipt. Please try again.');
            }
        };

        // Function to print return receipt
        window.printReturnReceipt = function(returnData) {
            try {
                // Build items HTML
                let itemsHtml = '';
                returnData.items.forEach(item => {
                    const details = [];
                    if (item.sizeName) details.push(`Size: ${item.sizeName}`);
                    if (item.colorName) details.push(`Color: ${item.colorName}`);
                    if (item.condition) details.push(`Condition: ${item.condition}`);
                    
                    const detailsHtml = details.length > 0 ? '<div class="item-details">' + details.join(', ') + '</div>' : '';
                    itemsHtml += '<tr>' +
                        '<td class="item-name">' +
                        '<div>' + item.productName + ' - ' + item.variantName + '</div>' +
                        detailsHtml +
                        '</td>' +
                        '<td class="item-qty">' + item.quantity + '</td>' +
                        '</tr>';
                });
                
                // Create HTML receipt
                const receiptHtml = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <meta charset="UTF-8">
                        <title>Return Receipt - ${returnData.returnNumber}</title>
                        <style>
                            @media print {
                                @page {
                                    size: 80mm auto;
                                    margin: 5mm;
                                }
                                body {
                                    margin: 0;
                                    padding: 0;
                                }
                                .no-print {
                                    display: none;
                                }
                            }
                            * {
                                margin: 0;
                                padding: 0;
                                box-sizing: border-box;
                            }
                            body {
                                font-family: 'Courier New', monospace;
                                font-size: 12px;
                                width: 70mm;
                                margin: 0 auto;
                                padding: 10px;
                                background: white;
                            }
                            .receipt-header {
                                text-align: center;
                                margin-bottom: 15px;
                            }
                            .store-name {
                                font-size: 18px;
                                font-weight: bold;
                                margin-bottom: 5px;
                            }
                            .thank-you {
                                font-size: 10px;
                                color: #666;
                                margin-bottom: 10px;
                            }
                            .divider {
                                border-top: 1px dashed #ccc;
                                margin: 10px 0;
                            }
                            .receipt-info {
                                margin-bottom: 10px;
                                font-size: 11px;
                            }
                            .receipt-info div {
                                margin: 3px 0;
                            }
                            .items-table {
                                width: 100%;
                                margin: 10px 0;
                                border-collapse: collapse;
                            }
                            .items-table th {
                                text-align: left;
                                font-size: 10px;
                                padding: 5px 0;
                                border-bottom: 1px dashed #ccc;
                            }
                            .items-table td {
                                padding: 5px 0;
                                font-size: 10px;
                            }
                            .item-name {
                                width: 70%;
                            }
                            .item-qty {
                                width: 30%;
                                text-align: center;
                            }
                            .item-details {
                                font-size: 9px;
                                color: #666;
                                margin-top: 2px;
                            }
                            .receipt-row {
                                display: flex;
                                justify-content: space-between;
                                margin: 5px 0;
                                font-size: 10px;
                            }
                            .receipt-footer {
                                text-align: center;
                                margin-top: 15px;
                                font-size: 10px;
                                color: #666;
                            }
                            .print-button {
                                position: fixed;
                                top: 10px;
                                right: 10px;
                                padding: 10px 20px;
                                background: #304D6D;
                                color: white;
                                border: none;
                                border-radius: 5px;
                                cursor: pointer;
                                font-size: 14px;
                            }
                            .print-button:hover {
                                background: #1e3a52;
                            }
                        </style>
                    </head>
                    <body>
                        <button class="print-button no-print" onclick="window.print()">Print Receipt</button>
                        
                        <div class="receipt-header">
                            <div class="store-name">SoftWear Store</div>
                            <div class="thank-you">Return Receipt</div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="receipt-info">
                            <div><strong>Return #:</strong> ${returnData.returnNumber}</div>
                            <div><strong>Sale #:</strong> ${returnData.saleNumber}</div>
                            <div><strong>Date:</strong> ${returnData.dateTime}</div>
                            <div><strong>Cashier:</strong> ${returnData.cashierName}</div>
                            <div><strong>Status:</strong> ${returnData.status}</div>
                            ${returnData.reason ? '<div><strong>Reason:</strong> ' + returnData.reason + '</div>' : ''}
                        </div>
                        
                        <div class="divider"></div>
                        
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th class="item-qty">Qty</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHtml}
                            </tbody>
                        </table>
                        
                        <div class="divider"></div>
                        
                        <div class="receipt-footer">
                            <div>Thank you!</div>
                        </div>
                    </body>
                    </html>
                `;
                
                // Use iframe method (works best with MAUI Blazor WebView)
                const printFrame = document.createElement('iframe');
                printFrame.name = 'returnReceiptPrintFrame';
                printFrame.style.position = 'fixed';
                printFrame.style.right = '0';
                printFrame.style.bottom = '0';
                printFrame.style.width = '1px';
                printFrame.style.height = '1px';
                printFrame.style.border = 'none';
                printFrame.style.opacity = '0.01';
                printFrame.style.pointerEvents = 'none';
                
                document.body.appendChild(printFrame);
                
                // Write HTML directly to iframe (no data URI needed)
                const printDoc = printFrame.contentDocument || printFrame.contentWindow.document;
                printDoc.open();
                printDoc.write(receiptHtml);
                printDoc.close();
                
                // Wait for iframe to load, then print
                setTimeout(function() {
                    try {
                        if (printFrame.contentWindow && printFrame.contentWindow.document.readyState === 'complete') {
                            printFrame.contentWindow.focus();
                            printFrame.contentWindow.print();
                        } else {
                            // If not ready, wait a bit more
                            printFrame.onload = function() {
                                setTimeout(function() {
                                    try {
                                        printFrame.contentWindow.focus();
                                        printFrame.contentWindow.print();
                                    } catch (e) {
                                        console.error('Error printing:', e);
                                        alert('Return receipt ready! Please use Ctrl+P or the Print button to print.');
                                    }
                                }, 500);
                            };
                        }
                    } catch (e) {
                        console.error('Error printing from iframe:', e);
                        alert('Return receipt ready! Please use Ctrl+P to print.');
                    }
                    
                    // Clean up iframe after printing
                    setTimeout(function() {
                        if (document.body.contains(printFrame)) {
                            document.body.removeChild(printFrame);
                        }
                    }, 3000);
                }, 1000);
            } catch (error) {
                console.error('Error generating return receipt:', error);
                alert('Error generating return receipt. Please try again.');
            }
        };

        // Function to filter input to allow only letters and specific characters, with auto-capitalization
        window.filterNameInput = function(elementId) {
            const element = document.getElementById(elementId);
            if (!element || element.hasAttribute('data-filtered')) return;
            
            element.setAttribute('data-filtered', 'true');
            
            // Helper function to capitalize first letter of each word
            function toTitleCase(str) {
                if (!str) return '';
                return str.toLowerCase().replace(/\b\w/g, function(char) {
                    return char.toUpperCase();
                });
            }
            
            // Filter on keydown to prevent typing special characters and numbers (use capture phase)
            element.addEventListener('keydown', function(e) {
                // Allow control keys
                const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape'];
                if (allowedKeys.includes(e.key) || e.ctrlKey || e.metaKey || e.altKey) {
                    return;
                }

                // Check if key is a character
                if (e.key.length === 1) {
                    const char = e.key;
                    // Only allow: letters, space, apostrophe, hyphen, period
                    // Block: numbers and all other special characters
                    if (!/[a-zA-Z\s'.-]/.test(char)) {
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    }
                }
            }, true);
            
            element.addEventListener('input', function(e) {
                const value = e.target.value;
                // Filter to allow only letters, spaces, apostrophes, hyphens, and periods
                let filtered = value.replace(/[^a-zA-Z\s'.-]/g, '');
                // Auto-capitalize: first letter of each word
                filtered = toTitleCase(filtered);
                if (value !== filtered) {
                    const start = this.selectionStart;
                    e.target.value = filtered;
                    // Adjust cursor position
                    const diff = value.length - filtered.length;
                    this.selectionStart = this.selectionEnd = Math.max(0, start - diff);
                    // Trigger input event for Blazor binding
                    e.target.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }, true);
            
            // Also handle paste
            element.addEventListener('paste', function(e) {
                e.preventDefault();
                e.stopPropagation();
                const paste = (e.clipboardData || window.clipboardData).getData('text');
                let filtered = paste.replace(/[^a-zA-Z\s'.-]/g, '');
                filtered = toTitleCase(filtered);
                const start = this.selectionStart;
                const end = this.selectionEnd;
                const currentValue = this.value;
                this.value = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                this.selectionStart = this.selectionEnd = start + filtered.length;
                this.dispatchEvent(new Event('input', { bubbles: true }));
            }, true);
        };

        // Function to setup search input filter to prevent special characters
        window.setupSearchInputFilter = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                // Filter on input event
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    // Remove special characters - only allow letters, numbers, spaces, hyphens, underscores
                    const filtered = value.replace(/[^a-zA-Z0-9\s\-_]/g, '');
                    if (filtered !== value) {
                        const start = this.selectionStart;
                        this.value = filtered;
                        // Adjust cursor position
                        const diff = value.length - filtered.length;
                        this.selectionStart = this.selectionEnd = Math.max(0, start - diff);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });

                // Filter on keydown to prevent typing special characters
                input.addEventListener('keydown', function(e) {
                    // Allow control keys
                    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape'];
                    if (allowedKeys.includes(e.key) || e.ctrlKey || e.metaKey || e.altKey) {
                        return;
                    }

                    // Check if key is a special character
                    if (e.key.length === 1) {
                        const char = e.key;
                        // Only allow: letters, numbers, space, hyphen, underscore
                        if (!/[a-zA-Z0-9\s\-_]/.test(char)) {
                            e.preventDefault();
                            return false;
                        }
                    }
                });

                // Filter on paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const filtered = paste.replace(/[^a-zA-Z0-9\s\-_]/g, '');
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    this.value = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                    this.selectionStart = this.selectionEnd = start + filtered.length;
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Function to close profile menu when clicking outside
        window.setupProfileMenuClose = function(dotNetRef) {
            document.addEventListener('click', function(e) {
                const profileContainer = document.getElementById('profile-menu-container');
                const profileMenu = document.querySelector('#profile-menu-container .absolute');
                
                if (profileContainer && profileMenu) {
                    // Check if click is outside both the container and the menu
                    if (!profileContainer.contains(e.target) && !profileMenu.contains(e.target)) {
                        dotNetRef.invokeMethodAsync('CloseProfileMenuFromJS');
                    }
                }
            });
        };
        // Function to setup GCash reference number filter (numbers only, 13 digits)
        window.setupGCashReferenceFilter = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                // Filter on input event - only allow numbers
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    // Remove all non-numeric characters
                    const filtered = value.replace(/[^0-9]/g, '');
                    // Limit to 13 digits
                    const limited = filtered.substring(0, 13);
                    if (limited !== value) {
                        const start = this.selectionStart;
                        this.value = limited;
                        // Adjust cursor position
                        const diff = value.length - limited.length;
                        this.selectionStart = this.selectionEnd = Math.max(0, start - diff);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });

                // Filter on keydown to prevent typing non-numeric characters
                input.addEventListener('keydown', function(e) {
                    // Allow control keys
                    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape'];
                    if (allowedKeys.includes(e.key) || e.ctrlKey || e.metaKey || e.altKey) {
                        return;
                    }

                    // Check if key is a number
                    if (e.key.length === 1) {
                        const char = e.key;
                        // Only allow numbers (0-9)
                        if (!/[0-9]/.test(char)) {
                            e.preventDefault();
                            return false;
                        }
                        
                        // Prevent if already at 13 digits
                        if (this.value.length >= 13 && !allowedKeys.includes(e.key)) {
                            e.preventDefault();
                            return false;
                        }
                    }
                });

                // Filter on paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    // Remove all non-numeric and limit to 13 digits
                    const filtered = paste.replace(/[^0-9]/g, '').substring(0, 13);
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    const newValue = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                    // Ensure total length doesn't exceed 13
                    this.value = newValue.substring(0, 13);
                    this.selectionStart = this.selectionEnd = Math.min(start + filtered.length, 13);
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Function to setup contact number filter (11 digits only, no special characters or letters)
        window.setupContactNumberFilter = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                // Filter on input event - only allow numbers
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    // Remove all non-numeric characters
                    const filtered = value.replace(/[^0-9]/g, '');
                    // Limit to 11 digits
                    const limited = filtered.substring(0, 11);
                    if (limited !== value) {
                        const start = this.selectionStart;
                        this.value = limited;
                        // Adjust cursor position
                        const diff = value.length - limited.length;
                        this.selectionStart = this.selectionEnd = Math.max(0, start - diff);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });

                // Filter on keydown to prevent typing non-numeric characters
                input.addEventListener('keydown', function(e) {
                    // Allow control keys
                    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape'];
                    if (allowedKeys.includes(e.key) || e.ctrlKey || e.metaKey || e.altKey) {
                        return;
                    }

                    // Check if key is a number
                    if (e.key.length === 1) {
                        const char = e.key;
                        // Only allow numbers (0-9)
                        if (!/[0-9]/.test(char)) {
                            e.preventDefault();
                            return false;
                        }
                        
                        // Prevent if already at 11 digits
                        if (this.value.length >= 11 && !allowedKeys.includes(e.key)) {
                            e.preventDefault();
                            return false;
                        }
                    }
                });

                // Filter on paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    // Remove all non-numeric and limit to 11 digits
                    const filtered = paste.replace(/[^0-9]/g, '').substring(0, 11);
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    const newValue = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                    // Ensure total length doesn't exceed 11
                    this.value = newValue.substring(0, 11);
                    this.selectionStart = this.selectionEnd = Math.min(start + filtered.length, 11);
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Function to setup email filter (allow standard email characters: letters, numbers, @, ., -, _)
        window.setupEmailFilter = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                // Filter on input event
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    // Allow letters, numbers, @, ., -, _
                    const filtered = value.replace(/[^a-zA-Z0-9@._-]/g, '');
                    if (filtered !== value) {
                        const start = this.selectionStart;
                        this.value = filtered;
                        // Adjust cursor position
                        const diff = value.length - filtered.length;
                        this.selectionStart = this.selectionEnd = Math.max(0, start - diff);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });

                // Filter on keydown to prevent typing special characters
                input.addEventListener('keydown', function(e) {
                    // Allow control keys
                    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape'];
                    if (allowedKeys.includes(e.key) || e.ctrlKey || e.metaKey || e.altKey) {
                        return;
                    }

                    // Check if key is a special character
                    if (e.key.length === 1) {
                        const char = e.key;
                        // Only allow: letters, numbers, @, ., -, _
                        if (!/[a-zA-Z0-9@._-]/.test(char)) {
                            e.preventDefault();
                            return false;
                        }
                    }
                });

                // Filter on paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const filtered = paste.replace(/[^a-zA-Z0-9@._-]/g, '');
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    this.value = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                    this.selectionStart = this.selectionEnd = start + filtered.length;
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Function to setup address filter (allow only letters, numbers, spaces, and -, ,, . as special characters)
        window.setupAddressFilter = function(inputId) {
            const input = document.getElementById(inputId);
            if (input) {
                // Filter on input event
                input.addEventListener('input', function(e) {
                    const value = this.value;
                    // Allow letters, numbers, spaces, hyphen, comma, period
                    const filtered = value.replace(/[^a-zA-Z0-9\s\-.,]/g, '');
                    if (filtered !== value) {
                        const start = this.selectionStart;
                        this.value = filtered;
                        // Adjust cursor position
                        const diff = value.length - filtered.length;
                        this.selectionStart = this.selectionEnd = Math.max(0, start - diff);
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });

                // Filter on keydown to prevent typing special characters
                input.addEventListener('keydown', function(e) {
                    // Allow control keys
                    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape'];
                    if (allowedKeys.includes(e.key) || e.ctrlKey || e.metaKey || e.altKey) {
                        return;
                    }

                    // Check if key is a special character
                    if (e.key.length === 1) {
                        const char = e.key;
                        // Only allow: letters, numbers, space, hyphen, comma, period
                        if (!/[a-zA-Z0-9\s\-.,]/.test(char)) {
                            e.preventDefault();
                            return false;
                        }
                    }
                });

                // Filter on paste
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const filtered = paste.replace(/[^a-zA-Z0-9\s\-.,]/g, '');
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    this.value = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                    this.selectionStart = this.selectionEnd = start + filtered.length;
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Function to setup textarea filter (no special characters except basic punctuation)
        window.setupTextareaFilter = function(textareaId) {
            const textarea = document.getElementById(textareaId);
            if (textarea) {
                textarea.addEventListener('input', function(e) {
                    const value = this.value;
                    // Allow letters, numbers, space, hyphen, underscore, period, comma, exclamation, question mark
                    const filtered = value.replace(/[^a-zA-Z0-9\s\-_.,!?]/g, '');
                    if (value !== filtered) {
                        const start = this.selectionStart;
                        this.value = filtered;
                        this.selectionStart = this.selectionEnd = Math.max(0, start - (value.length - filtered.length));
                        this.dispatchEvent(new Event('input', { bubbles: true }));
                    }
                });

                textarea.addEventListener('keydown', function(e) {
                    const allowedKeys = ['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Tab', 'Enter', 'Home', 'End', 'Escape', 'Control', 'Alt', 'Meta', 'Shift'];
                    if (allowedKeys.includes(e.key)) {
                        return;
                    }
                    if (e.key.length === 1) {
                        const charCode = e.key.charCodeAt(0);
                        if (!((charCode >= 65 && charCode <= 90) || // A-Z
                              (charCode >= 97 && charCode <= 122) || // a-z
                              (charCode >= 48 && charCode <= 57) || // 0-9
                              charCode === 32 || // space
                              charCode === 45 || // hyphen
                              charCode === 95 || // underscore
                              charCode === 46 || // period
                              charCode === 44 || // comma
                              charCode === 33 || // exclamation
                              charCode === 63)) // question mark
                        {
                            e.preventDefault();
                        }
                    } else if (!allowedKeys.includes(e.key)) {
                        e.preventDefault();
                    }
                });

                textarea.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text');
                    const filtered = paste.replace(/[^a-zA-Z0-9\s\-_.,!?]/g, '');
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const currentValue = this.value;
                    this.value = currentValue.substring(0, start) + filtered + currentValue.substring(end);
                    this.selectionStart = this.selectionEnd = start + filtered.length;
                    this.dispatchEvent(new Event('input', { bubbles: true }));
                });
            }
        };

        // Function to generate and print supplier report PDF
        window.generateAndPrintSupplierReport = function(suppliers, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text('Supplier Report', 14, 20);
                
                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, 30);
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, 36);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 42);
                
                // Table Data
                const tableData = suppliers.map(s => [
                    s.companyName || '',
                    s.contactPerson || 'N/A',
                    s.email || 'N/A',
                    s.contactNumber || 'N/A',
                    s.status || '',
                    `${s.dateCreated || ''} ${s.timeCreated || ''}`
                ]);
                
                // Create table
                doc.autoTable({
                    startY: 48,
                    head: [['Company Name', 'Contact Person', 'Email', 'Contact Number', 'Status', 'Date Created']],
                    body: tableData,
                    theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                    styles: {
                        fontSize: 7,
                        cellPadding: 2
                    },
                    columnStyles: {
                        0: { cellWidth: 50 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 50 },
                        3: { cellWidth: 40 },
                        4: { cellWidth: 25 },
                        5: { cellWidth: 45 }
                    }
                });
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }
                
                // Generate PDF blob
                const pdfBlob = doc.output('blob');
                
                // Download PDF
                doc.save('Supplier_Report.pdf');
                
                // Open PDF in new window for printing
                const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl);
                
                if (printWindow) {
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        setTimeout(() => {
                            URL.revokeObjectURL(pdfUrl);
                        }, 1000);
                    }, 1000);
                } else {
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.target = '_blank';
                    link.click();
                }
            } catch (error) {
                console.error('Error generating PDF:', error);
                window.print();
            }
        };

        // Function to print supplier receipt
        window.printSupplierReceipt = function(receiptData) {
            try {
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Please allow popups to print the receipt.');
                    return;
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Supplier Receipt - ${receiptData.id}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .header h1 { margin: 0; font-size: 20px; }
                            .info { margin: 10px 0; }
                            .label { font-weight: bold; }
                            .divider { border-top: 1px solid #000; margin: 15px 0; }
                            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>SUPPLIER RECEIPT</h1>
                            <p>ID: ${receiptData.id}</p>
                        </div>
                        <div class="info"><span class="label">Company Name:</span> ${receiptData.companyName}</div>
                        ${receiptData.contactPerson ? `<div class="info"><span class="label">Contact Person:</span> ${receiptData.contactPerson}</div>` : ''}
                        ${receiptData.email ? `<div class="info"><span class="label">Email:</span> ${receiptData.email}</div>` : ''}
                        ${receiptData.contactNumber ? `<div class="info"><span class="label">Contact Number:</span> ${receiptData.contactNumber}</div>` : ''}
                        <div class="info"><span class="label">Status:</span> ${receiptData.status}</div>
                        ${receiptData.street ? `<div class="info"><span class="label">Street:</span> ${receiptData.street}</div>` : ''}
                        ${receiptData.city ? `<div class="info"><span class="label">City:</span> ${receiptData.city}</div>` : ''}
                        ${receiptData.province ? `<div class="info"><span class="label">Province:</span> ${receiptData.province}</div>` : ''}
                        ${receiptData.zip ? `<div class="info"><span class="label">Zip Code:</span> ${receiptData.zip}</div>` : ''}
                        <div class="divider"></div>
                        <div class="info"><span class="label">Date Created:</span> ${receiptData.dateCreated}</div>
                        <div class="footer">
                            <p>Thank you for using SoftWear Inventory System</p>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                }, 250);
            } catch (error) {
                console.error('Error printing receipt:', error);
                alert('Failed to print receipt. Please try again.');
            }
        };

        // Function to generate and print PO completed report PDF - Professional Format matching Sales Report
        window.generateAndPrintPOCompletedReport = function(purchaseOrders, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values from purchase orders data
                const totalAmount = purchaseOrders.reduce((sum, po) => {
                    const amount = String(po.totalAmount || 0).replace(/â‚±/g, '').replace(/,/g, '').trim();
                    return sum + parseFloat(amount || 0);
                }, 0);
                const completedCount = purchaseOrders.filter(po => po.status === 'Completed').length;
                const pendingCount = purchaseOrders.filter(po => po.status === 'Pending').length;
                const cancelledCount = purchaseOrders.filter(po => po.status === 'Cancelled').length;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Purchase Order Reports', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Stock Clerk Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Seller'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Orders: ' + (purchaseOrders ? purchaseOrders.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Orders: ' + (purchaseOrders ? purchaseOrders.length : 0), 15, yPos);
                yPos += 5;
                doc.text('Total Amount: â‚±' + totalAmount.toFixed(2), 15, yPos);
                yPos += 5;
                doc.text('Completed: ' + completedCount + ' | Pending: ' + pendingCount + ' | Cancelled: ' + cancelledCount, 15, yPos);
                
                // === PURCHASE ORDERS TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const poData = purchaseOrders && purchaseOrders.length > 0
                    ? purchaseOrders.map(po => {
                        const amount = String(po.totalAmount || 0).replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            po.poNumber || '',
                            po.supplierName || '',
                            po.status || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            po.expectedDeliveryDate || 'N/A',
                            po.createdByName || 'N/A',
                            `${po.dateCompleted || ''} ${po.timeCompleted || ''}`
                        ];
                    })
                    : [['No purchase orders found', '', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['PO Number', 'Supplier', 'Status', 'Total Amount', 'Expected Delivery', 'Created By', 'Date']],
                    body: poData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto', halign: 'right' },
                        4: { cellWidth: 'auto' },
                        5: { cellWidth: 'auto' },
                        6: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: PO-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Purchase_Order_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print PO completed receipt
        window.printPOCompletedReceipt = function(receiptData) {
            try {
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Please allow popups to print the receipt.');
                    return;
                }

                let itemsHtml = '';
                if (receiptData.items && receiptData.items.length > 0) {
                    itemsHtml = '<div class="divider"></div><div class="info"><strong>Items:</strong></div>';
                    receiptData.items.forEach(item => {
                        itemsHtml += `<div class="info" style="margin-left: 20px;">
                            ${item.productName} - ${item.variantName}
                            ${item.sizeName ? ` (Size: ${item.sizeName})` : ''}
                            ${item.colorName ? ` (Color: ${item.colorName})` : ''}
                            - Qty: ${item.quantity} - â‚±${parseFloat(item.unitPrice || 0).toFixed(2)} = â‚±${parseFloat(item.totalPrice || 0).toFixed(2)}
                        </div>`;
                    });
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>PO Completed Receipt - ${receiptData.poNumber}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .header h1 { margin: 0; font-size: 20px; }
                            .info { margin: 10px 0; }
                            .label { font-weight: bold; }
                            .divider { border-top: 1px solid #000; margin: 15px 0; }
                            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>PURCHASE ORDER COMPLETED</h1>
                            <p>PO Number: ${receiptData.poNumber}</p>
                        </div>
                        <div class="info"><span class="label">Supplier:</span> ${receiptData.supplierName}</div>
                        ${receiptData.supplierEmail ? `<div class="info"><span class="label">Supplier Email:</span> ${receiptData.supplierEmail}</div>` : ''}
                        ${receiptData.supplierContactNumber ? `<div class="info"><span class="label">Supplier Contact:</span> ${receiptData.supplierContactNumber}</div>` : ''}
                        <div class="info"><span class="label">Status:</span> ${receiptData.status}</div>
                        <div class="info"><span class="label">Total Amount:</span> â‚±${parseFloat(receiptData.totalAmount || 0).toFixed(2)}</div>
                        ${receiptData.expectedDeliveryDate ? `<div class="info"><span class="label">Expected Delivery:</span> ${receiptData.expectedDeliveryDate}</div>` : ''}
                        ${receiptData.notes ? `<div class="info"><span class="label">Notes:</span> ${receiptData.notes}</div>` : ''}
                        ${itemsHtml}
                        <div class="divider"></div>
                        <div class="info"><span class="label">Created At:</span> ${receiptData.createdAt}</div>
                        ${receiptData.updatedAt ? `<div class="info"><span class="label">Completed At:</span> ${receiptData.updatedAt}</div>` : ''}
                        <div class="info"><span class="label">Created By:</span> ${receiptData.createdByName}</div>
                        ${receiptData.updatedByName ? `<div class="info"><span class="label">Completed By:</span> ${receiptData.updatedByName}</div>` : ''}
                        <div class="footer">
                            <p>Thank you for using SoftWear Inventory System</p>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                }, 250);
            } catch (error) {
                console.error('Error printing receipt:', error);
                alert('Failed to print receipt. Please try again.');
            }
        };

        // Function to generate and print PO cancelled report PDF
        window.generateAndPrintPOCancelledReport = function(purchaseOrders, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(18);
                doc.setTextColor(40, 40, 40);
                doc.text('Purchase Order Cancelled Report', 14, 20);
                
                // Report Info
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text(`Generated by: ${userName}`, 14, 30);
                doc.text(`Date Range: ${fromDate} - ${toDate}`, 14, 36);
                doc.text(`Generated: ${new Date().toLocaleString()}`, 14, 42);
                
                // Table Data
                const tableData = purchaseOrders.map(po => [
                    po.poNumber || '',
                    po.supplierName || '',
                    'â‚±' + parseFloat(String(po.totalAmount || 0).replace(/Â±/g, '').trim() || 0).toFixed(2),
                    po.expectedDeliveryDate || 'N/A',
                    `${po.dateCancelled || ''} ${po.timeCancelled || ''}`,
                    po.createdByName || 'N/A'
                ]);
                
                // Calculate totals
                const totalAmount = purchaseOrders.reduce((sum, po) => sum + parseFloat(po.totalAmount || 0), 0);
                
                // Create table
                doc.autoTable({
                    startY: 48,
                    head: [['PO Number', 'Supplier', 'Total Amount', 'Expected Delivery', 'Date Cancelled', 'Created By']],
                    body: tableData,
                    theme: 'striped',
                        headStyles: {
                            fillColor: [144, 238, 145],
                            textColor: [15, 63, 17],
                            fontStyle: 'bold'
                        },
                    styles: {
                        fontSize: 7,
                        cellPadding: 2
                    },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto', halign: 'right' },
                        3: { cellWidth: 'auto' },
                        4: { cellWidth: 'auto' },
                        5: { cellWidth: 'auto' }
                    },
                    foot: [['Total', '', 'â‚±' + totalAmount.toFixed(2), '', '', '']],
                    footStyles: {
                        fillColor: [144, 238, 145],
                        textColor: [15, 63, 17],
                        fontStyle: 'bold'
                    }
                });
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(
                        `Page ${i} of ${pageCount}`,
                        doc.internal.pageSize.getWidth() / 2,
                        doc.internal.pageSize.getHeight() - 10,
                        { align: 'center' }
                    );
                }
                
                // Generate PDF blob
                const pdfBlob = doc.output('blob');
                
                // Download PDF
                doc.save('PO_Cancelled_Report.pdf');
                
                // Open PDF in new window for printing
                const pdfUrl = URL.createObjectURL(pdfBlob);
                const printWindow = window.open(pdfUrl);
                
                if (printWindow) {
                    setTimeout(() => {
                        printWindow.focus();
                        printWindow.print();
                        setTimeout(() => {
                            URL.revokeObjectURL(pdfUrl);
                        }, 1000);
                    }, 1000);
                } else {
                    const link = document.createElement('a');
                    link.href = pdfUrl;
                    link.target = '_blank';
                    link.click();
                }
            } catch (error) {
                console.error('Error generating PDF:', error);
                window.print();
            }
        };

        // Function to print PO cancelled receipt
        window.printPOCancelledReceipt = function(receiptData) {
            try {
                const printWindow = window.open('', '_blank');
                if (!printWindow) {
                    alert('Please allow popups to print the receipt.');
                    return;
                }

                let itemsHtml = '';
                if (receiptData.items && receiptData.items.length > 0) {
                    itemsHtml = '<div class="divider"></div><div class="info"><strong>Items:</strong></div>';
                    receiptData.items.forEach(item => {
                        itemsHtml += `<div class="info" style="margin-left: 20px;">
                            ${item.productName} - ${item.variantName}
                            ${item.sizeName ? ` (Size: ${item.sizeName})` : ''}
                            ${item.colorName ? ` (Color: ${item.colorName})` : ''}
                            - Qty: ${item.quantity} - â‚±${parseFloat(item.unitPrice || 0).toFixed(2)} = â‚±${parseFloat(item.totalPrice || 0).toFixed(2)}
                        </div>`;
                    });
                }

                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>PO Cancelled Receipt - ${receiptData.poNumber}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
                            .header { text-align: center; margin-bottom: 20px; }
                            .header h1 { margin: 0; font-size: 20px; }
                            .info { margin: 10px 0; }
                            .label { font-weight: bold; }
                            .divider { border-top: 1px solid #000; margin: 15px 0; }
                            .footer { text-align: center; margin-top: 20px; font-size: 12px; color: #666; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h1>PURCHASE ORDER CANCELLED</h1>
                            <p>PO Number: ${receiptData.poNumber}</p>
                        </div>
                        <div class="info"><span class="label">Supplier:</span> ${receiptData.supplierName}</div>
                        ${receiptData.supplierEmail ? `<div class="info"><span class="label">Supplier Email:</span> ${receiptData.supplierEmail}</div>` : ''}
                        ${receiptData.supplierContactNumber ? `<div class="info"><span class="label">Supplier Contact:</span> ${receiptData.supplierContactNumber}</div>` : ''}
                        <div class="info"><span class="label">Status:</span> ${receiptData.status}</div>
                        <div class="info"><span class="label">Total Amount:</span> â‚±${parseFloat(receiptData.totalAmount || 0).toFixed(2)}</div>
                        ${receiptData.expectedDeliveryDate ? `<div class="info"><span class="label">Expected Delivery:</span> ${receiptData.expectedDeliveryDate}</div>` : ''}
                        ${receiptData.notes ? `<div class="info"><span class="label">Notes:</span> ${receiptData.notes}</div>` : ''}
                        ${itemsHtml}
                        <div class="divider"></div>
                        <div class="info"><span class="label">Created At:</span> ${receiptData.createdAt}</div>
                        ${receiptData.updatedAt ? `<div class="info"><span class="label">Cancelled At:</span> ${receiptData.updatedAt}</div>` : ''}
                        <div class="info"><span class="label">Created By:</span> ${receiptData.createdByName}</div>
                        ${receiptData.updatedByName ? `<div class="info"><span class="label">Cancelled By:</span> ${receiptData.updatedByName}</div>` : ''}
                        <div class="footer">
                            <p>Thank you for using SoftWear Inventory System</p>
                        </div>
                    </body>
                    </html>
                `);
                printWindow.document.close();
                setTimeout(() => {
                    printWindow.focus();
                    printWindow.print();
                }, 250);
            } catch (error) {
                console.error('Error printing receipt:', error);
                alert('Failed to print receipt. Please try again.');
            }
        };

        // Function to generate and print PO Approvals report PDF
        window.generateAndPrintPOApprovalsReport = function(purchaseOrders, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values from purchase orders data
                const totalAmount = purchaseOrders.reduce((sum, po) => {
                    const amount = String(po.totalAmount || 0).replace(/â‚±/g, '').replace(/,/g, '').trim();
                    return sum + parseFloat(amount || 0);
                }, 0);
                const pendingCount = purchaseOrders.filter(po => po.status === 'Pending').length;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Purchase Order Approvals Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Accounting'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Pending Orders: ' + (purchaseOrders ? purchaseOrders.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Pending Orders: ' + (purchaseOrders ? purchaseOrders.length : 0), 15, yPos);
                yPos += 5;
                doc.text('Total Amount: â‚±' + totalAmount.toFixed(2), 15, yPos);
                
                // === PURCHASE ORDERS TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const poData = purchaseOrders && purchaseOrders.length > 0
                    ? purchaseOrders.map(po => {
                        const amount = String(po.totalAmount || 0).replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            po.poNumber || '',
                            po.supplierName || '',
                            po.status || '',
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            po.expectedDeliveryDate || 'N/A',
                            po.createdByName || 'N/A',
                            `${po.createdAt || ''} ${po.timeCreated || ''}`
                        ];
                    })
                    : [['No pending purchase orders found', '', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['PO Number', 'Supplier', 'Status', 'Total Amount', 'Expected Delivery', 'Created By', 'Date']],
                    body: poData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto', halign: 'right' },
                        4: { cellWidth: 'auto' },
                        5: { cellWidth: 'auto' },
                        6: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: PO-APPROVALS-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Purchase_Order_Approvals_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to generate and print Returns Approvals report PDF
        window.generateAndPrintReturnsApprovalsReport = function(returns, userName, fromDate, toDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values
                const pendingCount = returns.filter(r => r.status === 'Pending').length;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Returns Approvals Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = fromDate && toDate ? `${fromDate} - ${toDate}` : (fromDate || toDate || 'All Time');
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (userName || 'Accounting'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Pending Returns: ' + (returns ? returns.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Pending Returns: ' + (returns ? returns.length : 0), 15, yPos);
                
                // === RETURNS TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const returnData = returns && returns.length > 0
                    ? returns.map(r => {
                        return [
                            r.returnNumber || '',
                            r.saleNumber || '',
                            r.cashierName || 'N/A',
                            r.status || '',
                            `${r.timestamps || ''} ${r.timeCreated || ''}`,
                            r.reason || 'N/A'
                        ];
                    })
                    : [['No pending returns found', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['Return Number', 'Sale Number', 'Cashier', 'Status', 'Date', 'Reason']],
                    body: returnData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto' },
                        4: { cellWidth: 'auto' },
                        5: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: RETURNS-APPROVALS-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Returns_Approvals_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print seller dashboard as PDF directly
        window.printSellerDashboard = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 15;

                // Helper function to add new page if needed
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                        return true;
                    }
                    return false;
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                // Line under letterhead
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 8;
                doc.setFillColor(30, 58, 95);
                doc.roundedRect(15, yPos, pageWidth - 30, 12, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.text('SELLER DASHBOARD REPORT', pageWidth / 2, yPos + 8, { align: 'center' });
                
                // === META INFO ===
                yPos += 20;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 14, 2, 2, 'F');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Report Period:', 20, yPos + 5);
                doc.text('Generated On:', pageWidth / 2 - 20, yPos + 5);
                doc.text('Prepared By:', pageWidth - 55, yPos + 5);
                
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 41, 55);
                doc.text(data.dateRange || 'All Time', 20, yPos + 10);
                doc.text(data.printedAt || '', pageWidth / 2 - 20, yPos + 10);
                doc.text(data.printedBy || '', pageWidth - 55, yPos + 10);
                
                // === FINANCIAL SUMMARY ===
                yPos += 22;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Financial Summary', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const finBoxWidth = (pageWidth - 40) / 5;
                const finData = [
                    { label: 'Total Sales', value: 'P' + data.financials.totalSales, color: [209, 250, 229] },
                    { label: 'Op. Expenses', value: 'P' + data.financials.totalExpenses, color: [254, 226, 226] },
                    { label: 'Supplier Pay', value: 'P' + data.financials.supplierPayments, color: [219, 234, 254] },
                    { label: 'Returns', value: 'P' + data.financials.totalReturns, color: [243, 244, 246] },
                    { label: 'Net Profit', value: 'P' + data.financials.netIncome, color: [219, 234, 254] }
                ];
                
                finData.forEach((item, i) => {
                    const x = 15 + (i * (finBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, finBoxWidth, 18, 2, 2, 'F');
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(75, 85, 99);
                    doc.text(item.label, x + finBoxWidth / 2, yPos + 5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(31, 41, 55);
                    doc.text(item.value, x + finBoxWidth / 2, yPos + 13, { align: 'center' });
                });
                
                // === INVENTORY OVERVIEW ===
                yPos += 28;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Inventory Overview', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const invData = [
                    { label: 'Stock In', value: data.inventory.totalStockIn.toString() },
                    { label: 'Stock Out', value: data.inventory.totalStockOut.toString() },
                    { label: 'Adjustments', value: data.inventory.totalAdjustments.toString() },
                    { label: 'Low Stock', value: data.inventory.lowStockItems.toString(), alert: data.inventory.lowStockItems > 0 },
                    { label: 'Products', value: data.inventory.totalProducts.toString() }
                ];
                
                invData.forEach((item, i) => {
                    const x = 15 + (i * (finBoxWidth + 2));
                    doc.setFillColor(249, 250, 251);
                    doc.roundedRect(x, yPos, finBoxWidth, 16, 2, 2, 'F');
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(12);
                    doc.setTextColor(item.alert ? 239 : 31, item.alert ? 68 : 41, item.alert ? 68 : 55);
                    doc.text(item.value, x + finBoxWidth / 2, yPos + 7, { align: 'center' });
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(107, 114, 128);
                    doc.text(item.label, x + finBoxWidth / 2, yPos + 12, { align: 'center' });
                });
                
                // === VERIFICATION STATUS ===
                yPos += 26;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Sales Verification Status', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const verBoxWidth = (pageWidth - 36) / 3;
                const verData = [
                    { label: 'Approved', value: data.verifications.approved.toString(), color: [209, 250, 229], textColor: [5, 150, 105] },
                    { label: 'Pending', value: data.verifications.pending.toString(), color: [219, 234, 254], textColor: [30, 58, 95] },
                    { label: 'Rejected', value: data.verifications.rejected.toString(), color: [254, 226, 226], textColor: [220, 38, 38] }
                ];
                
                verData.forEach((item, i) => {
                    const x = 15 + (i * (verBoxWidth + 3));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, verBoxWidth, 14, 2, 2, 'F');
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(12);
                    doc.setTextColor(...item.textColor);
                    doc.text(item.value, x + verBoxWidth / 2, yPos + 6, { align: 'center' });
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(107, 114, 128);
                    doc.text(item.label, x + verBoxWidth / 2, yPos + 11, { align: 'center' });
                });
                
                // === TOP SELLING PRODUCTS TABLE ===
                yPos += 22;
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Top Selling Products', 15, yPos);
                yPos += 4;
                
                const topProductsData = data.topProducts && data.topProducts.length > 0
                    ? data.topProducts.map((p, i) => [i + 1, p.name, p.quantity, 'P' + p.revenue])
                    : [['', 'No sales data available', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Product', 'Qty Sold', 'Revenue']],
                    body: topProductsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 12, halign: 'center' },
                        2: { halign: 'center' },
                        3: { halign: 'right' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === LOW STOCK ALERTS TABLE ===
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Low Stock Alerts', 15, yPos);
                yPos += 4;
                
                const lowStockData = data.lowStockList && data.lowStockList.length > 0
                    ? data.lowStockList.map(item => [item.product, item.variant, item.current, item.reorder])
                    : [['All stock levels are healthy', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Product', 'Variant', 'Current', 'Reorder Level']],
                    body: lowStockData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        2: { halign: 'center', textColor: data.lowStockList && data.lowStockList.length > 0 ? [239, 68, 68] : [31, 41, 55] },
                        3: { halign: 'center' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 15;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(30);
                doc.setDrawColor(209, 213, 219);
                doc.setLineDashPattern([2, 2], 0);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: RPT-' + Date.now(), 15, yPos + 12);
                
                // Signature line
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                // Save the PDF
                const fileName = 'Seller_Dashboard_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Cashier Dashboard as PDF (matching Seller Dashboard format)
        window.printCashierDashboard = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 15;

                // Helper function to add new page if needed
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                        return true;
                    }
                    return false;
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                // Line under letterhead
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 8;
                doc.setFillColor(30, 58, 95);
                doc.roundedRect(15, yPos, pageWidth - 30, 12, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.text('CASHIER DASHBOARD REPORT', pageWidth / 2, yPos + 8, { align: 'center' });
                
                // === META INFO ===
                yPos += 20;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 14, 2, 2, 'F');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Report Period:', 20, yPos + 5);
                doc.text('Generated On:', pageWidth / 2 - 20, yPos + 5);
                doc.text('Cashier:', pageWidth - 55, yPos + 5);
                
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 41, 55);
                doc.text(data.dateRange || 'All Time', 20, yPos + 10);
                doc.text(data.printedAt || '', pageWidth / 2 - 20, yPos + 10);
                doc.text(data.printedBy || '', pageWidth - 55, yPos + 10);
                
                // === SALES PERFORMANCE SUMMARY ===
                yPos += 22;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Sales Performance Summary', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const perfBoxWidth = (pageWidth - 40) / 5;
                const perfData = [
                    { label: 'Total Orders', value: data.stats.totalSales.toString(), color: [219, 234, 254] },
                    { label: 'Total Revenue', value: 'P' + data.stats.totalRevenue, color: [209, 250, 229] },
                    { label: 'Returns', value: data.stats.totalReturns.toString(), color: [243, 244, 246] },
                    { label: 'Today Sales', value: data.stats.todaySales.toString(), color: [219, 234, 254] },
                    { label: 'Today Revenue', value: 'P' + data.stats.todayRevenue, color: [209, 250, 229] }
                ];
                
                perfData.forEach((item, i) => {
                    const x = 15 + (i * (perfBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, perfBoxWidth, 18, 2, 2, 'F');
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(75, 85, 99);
                    doc.text(item.label, x + perfBoxWidth / 2, yPos + 5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(31, 41, 55);
                    doc.text(item.value, x + perfBoxWidth / 2, yPos + 13, { align: 'center' });
                });
                
                // === RETURNS & TRANSACTIONS ===
                yPos += 28;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Transaction Metrics', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const netSales = data.stats.totalSales - data.stats.totalReturns;
                const returnRate = data.stats.totalSales > 0 ? ((data.stats.totalReturns / data.stats.totalSales) * 100).toFixed(1) : '0.0';
                const txnData = [
                    { label: 'Net Sales', value: netSales.toString(), color: [209, 250, 229], textColor: [5, 150, 105] },
                    { label: 'Today Returns', value: data.stats.todayReturns.toString(), color: [254, 226, 226], textColor: [220, 38, 38] },
                    { label: 'Return Rate', value: returnRate + '%', color: [243, 244, 246], textColor: [107, 114, 128] },
                    { label: 'Avg Transaction', value: 'P' + data.avgTransaction, color: [219, 234, 254], textColor: [30, 58, 95] }
                ];
                
                const txnBoxWidth = (pageWidth - 36) / 4;
                txnData.forEach((item, i) => {
                    const x = 15 + (i * (txnBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, txnBoxWidth, 14, 2, 2, 'F');
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(12);
                    doc.setTextColor(...item.textColor);
                    doc.text(item.value, x + txnBoxWidth / 2, yPos + 6, { align: 'center' });
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(107, 114, 128);
                    doc.text(item.label, x + txnBoxWidth / 2, yPos + 11, { align: 'center' });
                });
                
                // === PAYMENT METHOD BREAKDOWN ===
                yPos += 22;
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Payment Method Breakdown', 15, yPos);
                yPos += 4;
                
                const paymentData = data.paymentMethods && data.paymentMethods.length > 0
                    ? data.paymentMethods.map(p => [p.paymentMethod, p.count.toString(), 'P' + p.totalAmount, p.percentage.toFixed(1) + '%'])
                    : [['No payment data', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Method', 'Count', 'Amount', '%']],
                    body: paymentData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 40 },
                        1: { cellWidth: 30, halign: 'center' },
                        2: { cellWidth: 45, halign: 'right' },
                        3: { cellWidth: 25, halign: 'center' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === TOP SELLING PRODUCTS TABLE ===
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Top Selling Products', 15, yPos);
                yPos += 4;
                
                const topProductsData = data.topProducts && data.topProducts.length > 0
                    ? data.topProducts.map((p, i) => [i + 1, p.productName + ' - ' + p.variantName, p.totalQuantity.toString(), 'P' + p.totalRevenue])
                    : [['', 'No sales data available', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Product', 'Qty', 'Revenue']],
                    body: topProductsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 12, halign: 'center' },
                        1: { cellWidth: 90 },
                        2: { cellWidth: 25, halign: 'center' },
                        3: { cellWidth: 35, halign: 'right' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === RECENT TRANSACTIONS TABLE ===
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Recent Transactions', 15, yPos);
                yPos += 4;
                
                const recentTxnData = data.recentTransactions && data.recentTransactions.length > 0
                    ? data.recentTransactions.map(t => [
                        t.saleNumber, 
                        new Date(t.timestamps).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' }),
                        t.paymentMethod,
                        'P' + t.amount
                    ])
                    : [['No recent transactions', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Sale #', 'Date/Time', 'Payment', 'Amount']],
                    body: recentTxnData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 40 },
                        1: { cellWidth: 55 },
                        2: { cellWidth: 35, halign: 'center' },
                        3: { cellWidth: 35, halign: 'right' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === PEAK HOURS SUMMARY ===
                if (data.peakHour && data.peakHour !== 'N/A') {
                    checkNewPage(30);
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(11);
                    doc.setTextColor(30, 58, 95);
                    doc.text('Performance Insights', 15, yPos);
                    yPos += 4;
                    
                    const insightsData = [
                        ['Peak Sales Hour', data.peakHour],
                        ['Preferred Payment', data.preferredPayment || 'N/A'],
                        ['Top Product', data.topProduct || 'N/A'],
                        ['Avg Transaction Value', 'P' + data.avgTransaction]
                    ];
                    
                    doc.autoTable({
                        startY: yPos,
                        head: [['Metric', 'Value']],
                        body: insightsData,
                        theme: 'grid',
                        headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                        bodyStyles: { fontSize: 8 },
                        columnStyles: {
                            0: { cellWidth: 60, fontStyle: 'bold' },
                            1: { cellWidth: 60 }
                        },
                        margin: { left: 15, right: 15 }
                    });
                    
                    yPos = doc.lastAutoTable.finalY + 15;
                }
                
                // === NOTHING FOLLOWS ===
                checkNewPage(30);
                doc.setDrawColor(209, 213, 219);
                doc.setLineDashPattern([2, 2], 0);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Point of Sale System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: CSH-' + Date.now(), 15, yPos + 12);
                
                // Signature line
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Cashier Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                // Save the PDF
                const fileName = 'Cashier_Dashboard_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Admin Dashboard as PDF
        window.printAdminDashboard = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 15;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                        return true;
                    }
                    return false;
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 8;
                doc.setFillColor(30, 58, 95);
                doc.roundedRect(15, yPos, pageWidth - 30, 12, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.text('ADMIN DASHBOARD REPORT', pageWidth / 2, yPos + 8, { align: 'center' });
                
                // === META INFO ===
                yPos += 20;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 14, 2, 2, 'F');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Report Period:', 20, yPos + 5);
                doc.text('Generated On:', pageWidth / 2 - 20, yPos + 5);
                doc.text('Prepared By:', pageWidth - 55, yPos + 5);
                
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 41, 55);
                doc.text(data.dateRange || 'All Time', 20, yPos + 10);
                doc.text(data.printedAt || '', pageWidth / 2 - 20, yPos + 10);
                doc.text(data.printedBy || '', pageWidth - 55, yPos + 10);
                
                // === FEE SUMMARY ===
                yPos += 22;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Admin Fee Collection Summary', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const feeBoxWidth = (pageWidth - 40) / 4;
                const feeData = [
                    { label: 'Total Admin Fees', value: 'P' + data.fees.totalAdminFees, color: [224, 231, 255] },
                    { label: 'Seller Revenue', value: 'P' + data.fees.sellerRevenue, color: [209, 250, 229] },
                    { label: 'Active Sellers', value: data.fees.activeSellers, color: [219, 234, 254] },
                    { label: 'Transactions', value: data.fees.totalTransactions, color: [254, 243, 199] }
                ];
                
                feeData.forEach((item, i) => {
                    const x = 15 + (i * (feeBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, feeBoxWidth, 18, 2, 2, 'F');
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(75, 85, 99);
                    doc.text(item.label, x + feeBoxWidth / 2, yPos + 5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(31, 41, 55);
                    doc.text(item.value.toString(), x + feeBoxWidth / 2, yPos + 13, { align: 'center' });
                });
                
                // === USER MANAGEMENT ===
                yPos += 28;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('User Management Overview', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const userBoxWidth = (pageWidth - 40) / 5;
                const userData = [
                    { label: 'Admins', value: data.users.admins.toString() },
                    { label: 'Sellers', value: data.users.sellers.toString() },
                    { label: 'Cashiers', value: data.users.cashiers.toString() },
                    { label: 'Accounting', value: data.users.accounting.toString() },
                    { label: 'Stock Clerks', value: data.users.stockClerks.toString() }
                ];
                
                userData.forEach((item, i) => {
                    const x = 15 + (i * (userBoxWidth + 2));
                    doc.setFillColor(249, 250, 251);
                    doc.roundedRect(x, yPos, userBoxWidth, 16, 2, 2, 'F');
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(12);
                    doc.setTextColor(30, 58, 95);
                    doc.text(item.value, x + userBoxWidth / 2, yPos + 7, { align: 'center' });
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(107, 114, 128);
                    doc.text(item.label, x + userBoxWidth / 2, yPos + 12, { align: 'center' });
                });
                
                // === TOP SELLERS TABLE ===
                yPos += 26;
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Top Sellers by Admin Fee', 15, yPos);
                yPos += 4;
                
                const topSellersData = data.topSellers && data.topSellers.length > 0
                    ? data.topSellers.map((s, i) => [i + 1, s.name, 'P' + s.revenue, 'P' + s.adminFee])
                    : [['', 'No seller data available', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Seller Name', 'Revenue', 'Admin Fee (2%)']],
                    body: topSellersData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 12, halign: 'center' },
                        2: { halign: 'right' },
                        3: { halign: 'right' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ADM-' + Date.now(), 15, yPos + 12);
                
                // Signature line
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Admin_Dashboard_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Admin Fee Summary as PDF
        window.printAdminFeeSummary = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 15;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                        return true;
                    }
                    return false;
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 8;
                doc.setFillColor(30, 58, 95);
                doc.roundedRect(15, yPos, pageWidth - 30, 12, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.text('ADMIN FEE SUMMARY REPORT', pageWidth / 2, yPos + 8, { align: 'center' });
                
                // === META INFO ===
                yPos += 20;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 14, 2, 2, 'F');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Report Period:', 20, yPos + 5);
                doc.text('Generated On:', pageWidth / 2 - 20, yPos + 5);
                doc.text('Prepared By:', pageWidth - 55, yPos + 5);
                
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 41, 55);
                doc.text(data.dateRange || 'All Time', 20, yPos + 10);
                doc.text(data.printedAt || '', pageWidth / 2 - 20, yPos + 10);
                doc.text(data.printedBy || '', pageWidth - 55, yPos + 10);
                
                // === KPI SUMMARY ===
                yPos += 22;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Fee Collection Overview', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const kpiBoxWidth = (pageWidth - 40) / 4;
                const kpiData = [
                    { label: 'Total Admin Fees', value: 'P' + data.kpi.totalAdminFees, color: [224, 231, 255] },
                    { label: 'Gross Revenue', value: 'P' + data.kpi.grossRevenue, color: [209, 250, 229] },
                    { label: 'Active Sellers', value: data.kpi.activeSellers, color: [219, 234, 254] },
                    { label: 'Transactions', value: data.kpi.totalTransactions, color: [254, 243, 199] }
                ];
                
                kpiData.forEach((item, i) => {
                    const x = 15 + (i * (kpiBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, kpiBoxWidth, 18, 2, 2, 'F');
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(75, 85, 99);
                    doc.text(item.label, x + kpiBoxWidth / 2, yPos + 5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(31, 41, 55);
                    doc.text(item.value.toString(), x + kpiBoxWidth / 2, yPos + 13, { align: 'center' });
                });
                
                // === SELLER BREAKDOWN TABLE ===
                yPos += 28;
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Seller Fee Breakdown', 15, yPos);
                yPos += 4;
                
                const sellersData = data.sellers && data.sellers.length > 0
                    ? data.sellers.map((s, i) => [i + 1, s.name, 'P' + s.revenue, 'P' + s.adminFee, s.transactions, 'P' + s.netToSeller])
                    : [['', 'No seller data available', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Seller', 'Revenue', 'Admin Fee', 'Sales', 'Net to Seller']],
                    body: sellersData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 10, halign: 'center' },
                        2: { halign: 'right' },
                        3: { halign: 'right' },
                        4: { halign: 'center' },
                        5: { halign: 'right' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: FEE-' + Date.now(), 15, yPos + 12);
                
                // Signature line
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Admin_Fee_Summary_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Database Sync Report as PDF
        // Function to print Daily Sales Verification Report
        window.printDailySalesVerification = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // Calculate summary values
                const totalSales = data.reports ? data.reports.reduce((sum, r) => {
                    const amount = String(r.totalSales || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                    return sum + parseFloat(amount || 0);
                }, 0) : 0;
                const totalTransactions = data.reports ? data.reports.reduce((sum, r) => sum + parseInt(r.transactions || 0), 0) : 0;
                const pendingCount = data.reports ? data.reports.filter(r => r.status === 'Pending').length : 0;
                const verifiedCount = data.reports ? data.reports.filter(r => r.status === 'Verified').length : 0;
                const rejectedCount = data.reports ? data.reports.filter(r => r.status === 'Rejected').length : 0;
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Daily Sales Verification Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = data.dateRange || 'All Time';
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Accounting'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Reports: ' + (data.reports ? data.reports.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Reports: ' + (data.reports ? data.reports.length : 0), 15, yPos);
                yPos += 5;
                doc.text('Total Sales: â‚±' + totalSales.toFixed(2), 15, yPos);
                yPos += 5;
                doc.text('Total Transactions: ' + totalTransactions, 15, yPos);
                yPos += 5;
                doc.text('Pending: ' + pendingCount + ' | Verified: ' + verifiedCount + ' | Rejected: ' + rejectedCount, 15, yPos);
                
                // === DAILY SALES REPORTS TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const reportData = data.reports && data.reports.length > 0
                    ? data.reports.map(r => {
                        const salesAmount = String(r.totalSales || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        const cashAmount = String(r.cash || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        const gcashAmount = String(r.gcash || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            r.cashierName || '',
                            r.date || '',
                            'â‚±' + parseFloat(salesAmount || 0).toFixed(2),
                            r.transactions || '0',
                            'â‚±' + parseFloat(cashAmount || 0).toFixed(2),
                            'â‚±' + parseFloat(gcashAmount || 0).toFixed(2),
                            r.returns || '0',
                            r.status || ''
                        ];
                    })
                    : [['No daily sales reports found', '', '', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['Cashier', 'Date', 'Total Sales', 'Transactions', 'Cash', 'GCash', 'Returns', 'Status']],
                    body: reportData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto', halign: 'right' },
                        3: { cellWidth: 'auto', halign: 'right' },
                        4: { cellWidth: 'auto', halign: 'right' },
                        5: { cellWidth: 'auto', halign: 'right' },
                        6: { cellWidth: 'auto', halign: 'right' },
                        7: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: DSV-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Daily_Sales_Verification_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Expenses Report
        window.printExpenses = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Expense Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = data.dateRange || 'All Time';
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Accounting'), 15, yPos);
                doc.text('Date: ' + (data.printedAt || ''), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Expenses: ' + (data.kpi.totalRecords || '0'), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Expenses: â‚±' + (data.kpi.totalExpenses || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Records: ' + (data.kpi.totalRecords || '0'), 15, yPos);
                yPos += 5;
                doc.text('Average Expense: â‚±' + (data.kpi.avgExpense || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('This Month: â‚±' + (data.kpi.thisMonthExpenses || '0.00'), 15, yPos);
                
                // === EXPENSES TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const expenseData = data.expenses && data.expenses.length > 0
                    ? data.expenses.map(e => {
                        const amount = String(e.amount || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            e.date || '',
                            e.type || '',
                            (e.description || '').substring(0, 40),
                            'â‚±' + parseFloat(amount || 0).toFixed(2),
                            e.createdBy || '',
                            e.hasReceipt ? 'Yes' : 'No'
                        ];
                    })
                    : [['No expenses found', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['Date', 'Type', 'Description', 'Amount', 'Created By', 'Receipt']],
                    body: expenseData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto', halign: 'right' },
                        4: { cellWidth: 'auto' },
                        5: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: EXP-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Expenses_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Supplier Payments Report
        window.printSupplierPayments = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text('Supplier Payments Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const dateRangeText = data.dateRange || 'All Time';
                doc.text('Accounting Portal â€¢ ' + dateRangeText, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + (data.printedBy || 'Accounting'), 15, yPos);
                doc.text('Date: ' + new Date().toLocaleString('en-US', { 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric', 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                }), pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Invoices: ' + (data.invoices ? data.invoices.length : 0), 15, yPos + 5);
                
                // === SUMMARY SECTION ===
                yPos += 15;
                checkNewPage(40);
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(9);
                doc.setTextColor(30, 58, 95);
                doc.text('Summary', 15, yPos);
                
                yPos += 8;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Total Amount: â‚±' + (data.kpi.totalAmount || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Paid: â‚±' + (data.kpi.totalPaid || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Remaining Balance: â‚±' + (data.kpi.remainingBalance || '0.00'), 15, yPos);
                yPos += 5;
                doc.text('Total Invoices: ' + (data.kpi.totalInvoices || '0'), 15, yPos);
                
                // === SUPPLIER INVOICES TABLE ===
                yPos += 10;
                checkNewPage(50);
                
                const invoiceData = data.invoices && data.invoices.length > 0
                    ? data.invoices.map(i => {
                        const totalAmount = String(i.totalAmount || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        const totalPaid = String(i.totalPaid || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        const remainingBalance = String(i.remainingBalance || '0').replace(/â‚±/g, '').replace(/,/g, '').trim();
                        return [
                            (i.invoiceNumber || '').substring(0, 25),
                            (i.supplierName || '').substring(0, 20),
                            i.date || '',
                            'â‚±' + parseFloat(totalAmount || 0).toFixed(2),
                            'â‚±' + parseFloat(totalPaid || 0).toFixed(2),
                            'â‚±' + parseFloat(remainingBalance || 0).toFixed(2),
                            i.status || '',
                            i.sourceType || ''
                        ];
                    })
                    : [['No supplier invoices found', '', '', '', '', '', '', '']];
                
                // Create table
                doc.autoTable({
                    startY: yPos,
                    head: [['Invoice/PO', 'Supplier', 'Date', 'Total Amount', 'Paid', 'Balance', 'Status', 'Source']],
                    body: invoiceData,
                    theme: 'grid',
                    headStyles: { 
                        fillColor: [30, 58, 95], 
                        fontSize: 8, 
                        fontStyle: 'bold',
                        textColor: [255, 255, 255]
                    },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 'auto' },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 'auto', halign: 'right' },
                        4: { cellWidth: 'auto', halign: 'right' },
                        5: { cellWidth: 'auto', halign: 'right' },
                        6: { cellWidth: 'auto' },
                        7: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SUP-PAY-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Supplier_Payments_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        window.printAdminFeeSummary = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 15;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                        return true;
                    }
                    return false;
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 8;
                doc.setFillColor(30, 58, 95);
                doc.roundedRect(15, yPos, pageWidth - 30, 12, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.text('DATABASE SYNC STATUS REPORT', pageWidth / 2, yPos + 8, { align: 'center' });
                
                // === META INFO ===
                yPos += 20;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 14, 2, 2, 'F');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Generated On:', 20, yPos + 5);
                doc.text('Prepared By:', pageWidth / 2 - 20, yPos + 5);
                doc.text('Auto-Sync:', pageWidth - 55, yPos + 5);
                
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 41, 55);
                doc.text(data.printedAt || '', 20, yPos + 10);
                doc.text(data.printedBy || '', pageWidth / 2 - 20, yPos + 10);
                doc.text(data.autoSyncEnabled ? 'Enabled' : 'Disabled', pageWidth - 55, yPos + 10);
                
                // === CONNECTION STATUS ===
                yPos += 22;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Connection Status', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const connBoxWidth = (pageWidth - 40) / 4;
                const connData = [
                    { label: 'Local DB', value: data.localConnected ? 'Online' : 'Offline', color: data.localConnected ? [209, 250, 229] : [254, 226, 226] },
                    { label: 'Azure DB', value: data.azureConnected ? 'Online' : 'Offline', color: data.azureConnected ? [209, 250, 229] : [254, 226, 226] },
                    { label: 'Local Rows', value: data.localRowCount, color: [219, 234, 254] },
                    { label: 'Azure Rows', value: data.azureRowCount, color: [224, 231, 255] }
                ];
                
                connData.forEach((item, i) => {
                    const x = 15 + (i * (connBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, connBoxWidth, 18, 2, 2, 'F');
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(75, 85, 99);
                    doc.text(item.label, x + connBoxWidth / 2, yPos + 5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(31, 41, 55);
                    doc.text(item.value.toString(), x + connBoxWidth / 2, yPos + 13, { align: 'center' });
                });
                
                // === TABLES COMPARISON ===
                yPos += 28;
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Table Comparison', 15, yPos);
                yPos += 4;
                
                const tablesData = data.tables && data.tables.length > 0
                    ? data.tables.map((t, i) => [i + 1, t.name, t.localRows, t.azureRows, t.status])
                    : [['', 'No tables available', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['#', 'Table Name', 'Local Rows', 'Azure Rows', 'Status']],
                    body: tablesData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        0: { cellWidth: 10, halign: 'center' },
                        2: { halign: 'center' },
                        3: { halign: 'center' },
                        4: { halign: 'center' }
                    },
                    margin: { left: 15, right: 15 }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SYNC-' + Date.now(), 15, yPos + 12);
                
                // Signature line
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Database_Sync_Report_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Function to print Monthly Collection Report as PDF
        window.printMonthlyCollection = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 15;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                        return true;
                    }
                    return false;
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 8;
                doc.setFillColor(30, 58, 95);
                doc.roundedRect(15, yPos, pageWidth - 30, 12, 2, 2, 'F');
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(255, 255, 255);
                doc.text('MONTHLY FEE COLLECTION REPORT - ' + data.year, pageWidth / 2, yPos + 8, { align: 'center' });
                
                // === META INFO ===
                yPos += 20;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 14, 2, 2, 'F');
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Year:', 20, yPos + 5);
                doc.text('Generated On:', pageWidth / 2 - 20, yPos + 5);
                doc.text('Prepared By:', pageWidth - 55, yPos + 5);
                
                doc.setFont('helvetica', 'bold');
                doc.setTextColor(31, 41, 55);
                doc.text(data.year.toString(), 20, yPos + 10);
                doc.text(data.printedAt || '', pageWidth / 2 - 20, yPos + 10);
                doc.text(data.printedBy || '', pageWidth - 55, yPos + 10);
                
                // === ANNUAL SUMMARY ===
                yPos += 22;
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Annual Summary', 15, yPos);
                yPos += 2;
                doc.setDrawColor(229, 231, 235);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                yPos += 5;
                const annBoxWidth = (pageWidth - 40) / 4;
                const annData = [
                    { label: 'Annual Admin Fees', value: 'P' + data.annualFees, color: [224, 231, 255] },
                    { label: 'Annual Revenue', value: 'P' + data.annualRevenue, color: [209, 250, 229] },
                    { label: 'Avg Monthly Fee', value: 'P' + data.avgMonthlyFee, color: [219, 234, 254] },
                    { label: 'Active Months', value: data.activeMonths, color: [254, 243, 199] }
                ];
                
                annData.forEach((item, i) => {
                    const x = 15 + (i * (annBoxWidth + 2));
                    doc.setFillColor(...item.color);
                    doc.roundedRect(x, yPos, annBoxWidth, 18, 2, 2, 'F');
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(7);
                    doc.setTextColor(75, 85, 99);
                    doc.text(item.label, x + annBoxWidth / 2, yPos + 5, { align: 'center' });
                    doc.setFont('helvetica', 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(31, 41, 55);
                    doc.text(item.value.toString(), x + annBoxWidth / 2, yPos + 13, { align: 'center' });
                });
                
                // === MONTHLY BREAKDOWN TABLE ===
                yPos += 28;
                checkNewPage(50);
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(11);
                doc.setTextColor(30, 58, 95);
                doc.text('Monthly Breakdown', 15, yPos);
                yPos += 4;
                
                const monthsData = data.months && data.months.length > 0
                    ? data.months.map((m, i) => [m.name, 'P' + m.revenue, 'P' + m.adminFee, m.transactions])
                    : [['No data', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Month', 'Revenue', 'Admin Fee (2%)', 'Transactions']],
                    body: monthsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 8 },
                    columnStyles: {
                        1: { halign: 'right' },
                        2: { halign: 'right' },
                        3: { halign: 'center' }
                    },
                    margin: { left: 15, right: 15 },
                    foot: [['TOTAL', 'P' + data.annualRevenue, 'P' + data.annualFees, data.totalTransactions]],
                    footStyles: { fillColor: [243, 244, 246], fontStyle: 'bold' }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: MCR-' + Date.now(), 15, yPos + 12);
                
                // Signature line
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Monthly_Collection_' + data.year + '_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };
        
        // Activity Log Report PDF
        window.printActivityLog = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Activity Log Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                const portal = data.portal || 'Admin Portal';
                doc.text(portal + ' â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Activities: ' + data.totalActivities, 15, yPos + 5);
                
                // === ACTIVITY LOG TABLE ===
                yPos += 15;
                
                const logsData = data.logs && data.logs.length > 0
                    ? data.logs.map(l => [l.status, l.module, l.description, l.date + ' ' + l.time])
                    : [['No activity logs found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['Status', 'Module', 'Description', 'Date & Time']],
                    body: logsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 25 },
                        1: { cellWidth: 30 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 40 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                    
                    // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ACT-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Activity_Log_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Admin Records - Professional Format matching ActivityLog exactly
        window.printAdminRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Admin Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Admin Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === ADMIN RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.dateCreated || ''])
                    : [['No admin records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ADM-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Admin_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Seller Records
        window.printSellerRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Seller Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === SELLER RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.dateCreated || ''])
                    : [['No seller records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SLR-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Seller_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Accounting Records - Professional Format matching Admin Records exactly
        window.printAccountingRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Accounting Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === ACCOUNTING RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.dateCreated || ''])
                    : [['No accounting records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ACC-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Accounting_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Cashier Records - Professional Format matching Admin Records exactly
        window.printCashierRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Cashier Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === CASHIER RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.dateCreated || ''])
                    : [['No cashier records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: CSR-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Cashier_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Stock Clerk Records - Professional Format matching Admin Records exactly
        window.printStockClerkRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Stock Clerk Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === STOCK CLERK RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.dateCreated || ''])
                    : [['No stock clerk records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SCK-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Stock_Clerk_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Category Records - Professional Format matching Cashier Records exactly
        window.printCategoryRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Category Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === CATEGORY RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.description || '', r.dateCreated || ''])
                    : [['No category records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Description', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: CAT-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Category_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Color Records - Professional Format matching Cashier Records exactly
        window.printColorRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Color Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === COLOR RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.hexValue || '', r.description || '', r.dateCreated || ''])
                    : [['No color records found', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Hex Value', 'Description', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 35 },
                        2: { cellWidth: 25 },
                        3: { cellWidth: 'auto' },
                        4: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: COL-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Color_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Size Records - Professional Format matching Cashier Records exactly
        window.printSizeRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Size Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === SIZE RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.description || '', r.dateCreated || ''])
                    : [['No size records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Description', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SIZ-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Size_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Product Records - Professional Format matching Cashier Records exactly
        window.printProductRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Product Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === PRODUCT RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.category || '', r.description || '', r.dateCreated || ''])
                    : [['No product records found', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Category', 'Description', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 35 },
                        2: { cellWidth: 25 },
                        3: { cellWidth: 'auto' },
                        4: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: PRO-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Product_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Variant Records - Professional Format matching Cashier Records exactly
        window.printVariantRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Variant Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === VARIANT RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.product || '', r.price || '', r.dateCreated || ''])
                    : [['No variant records found', '', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Product', 'Price', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 35 },
                        2: { cellWidth: 40 },
                        3: { cellWidth: 25 },
                        4: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: VAR-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Variant_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Supplier Records - Professional Format matching Admin Records exactly
        window.printSupplierRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Supplier Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === SUPPLIER RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.dateCreated || ''])
                    : [['No supplier records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Company Name', 'Email', 'Date Created']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: SUP-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Supplier_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Admin Records - Professional format matching ActivityLog
        window.printArchivedAdminRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Admin Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Admin Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED ADMIN RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.archivedDate || ''])
                    : [['No archived admin records found', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: AAR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Admin_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Expense Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedExpenses = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Expense Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Accounting Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED EXPENSE RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.expenseType || '', 'â‚±' + r.amount, r.expenseDate || '', r.archivedDate || '', r.createdBy || ''])
                    : [['No archived expenses found', '', '', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Expense Type', 'Amount', 'Expense Date', 'Archived Date', 'Created By']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 15 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 25, halign: 'right' },
                        3: { cellWidth: 30 },
                        4: { cellWidth: 30 },
                        5: { cellWidth: 'auto' }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: AER-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Expense_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Supplier Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedSupplierRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Supplier Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === ARCHIVED SUPPLIER RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.archivedDate || ''])
                    : [['No archived supplier records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Company Name', 'Email', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ASR-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Archived_Supplier_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Stock Clerk Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedStockClerkRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Stock Clerk Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === ARCHIVED STOCK CLERK RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.archivedDate || ''])
                    : [['No archived stock clerk records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ASC-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Archived_Stock_Clerk_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Cashier Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedCashierRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Cashier Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === ARCHIVED CASHIER RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.archivedDate || ''])
                    : [['No archived cashier records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ACR-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Archived_Cashier_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Accounting Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedAccountingRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Accounting Records Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === ARCHIVED ACCOUNTING RECORDS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.archivedDate || ''])
                    : [['No archived accounting records found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: AAC-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Archived_Accounting_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Seller Records - Professional format matching ActivityLog
        window.printArchivedSellerRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Seller Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Admin Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED SELLER RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.email || '', r.archivedDate || ''])
                    : [['No archived seller records found', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Email', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ASR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Seller_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Category Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedCategoryRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Category Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED CATEGORY RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.description || 'N/A', r.archivedDate || ''])
                    : [['No archived category records found', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Description', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ACR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Category_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Color Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedColorRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Color Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED COLOR RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.hexValue || '', r.archivedDate || ''])
                    : [['No archived color records found', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Hex Value', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 35 },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ACoR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Color_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Size Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedSizeRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Size Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED SIZE RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.description || 'N/A', r.archivedDate || ''])
                    : [['No archived size records found', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Description', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 45 },
                        2: { cellWidth: 'auto' },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: ASiR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Size_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Product Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedProductRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Product Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED PRODUCT RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.categoryName || '', r.archivedDate || ''])
                    : [['No archived product records found', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Category', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 20 },
                        1: { cellWidth: 50 },
                        2: { cellWidth: 40 },
                        3: { cellWidth: 35 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: APR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Product_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Archived Variant Records - Professional Format matching Archived Admin Records exactly
        window.printArchivedVariantRecords = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;

                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };

                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });

                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });

                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);

                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Archived Variant Records Report', pageWidth / 2, yPos + 10, { align: 'center' });

                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Seller Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });

                yPos += 32;

                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);

                // === ARCHIVED VARIANT RECORDS TABLE ===
                yPos += 15;

                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [String(r.id), r.name || '', r.productName || '', r.price || '', r.archivedDate || ''])
                    : [['No archived variant records found', '', '', '', '']];

                doc.autoTable({
                    startY: yPos,
                    head: [['ID', 'Name', 'Product', 'Price', 'Archived Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], textColor: [255, 255, 255], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 18 },
                        1: { cellWidth: 40 },
                        2: { cellWidth: 35 },
                        3: { cellWidth: 25 },
                        4: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });

                yPos = doc.lastAutoTable.finalY + 10;

                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);

                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;

                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: AVR-' + Date.now(), 15, yPos + 12);

                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });

                const fileName = 'Archived_Variant_Records_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);

            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };

        // Print Permission Requests
        window.printPermissionRequests = function(data) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                let yPos = 10;
                
                const checkNewPage = (neededSpace) => {
                    if (yPos + neededSpace > pageHeight - 30) {
                        doc.addPage();
                        yPos = 20;
                    }
                };
                
                // === LETTERHEAD ===
                doc.setFillColor(30, 58, 95);
                doc.rect(0, 0, pageWidth, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(24);
                doc.setTextColor(30, 58, 95);
                doc.text('SOFTWEAR', pageWidth / 2, yPos + 5, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(107, 114, 128);
                doc.text('Fashion & Apparel Management Solutions', pageWidth / 2, yPos + 12, { align: 'center' });
                
                doc.setFontSize(7);
                doc.text('Azucena, Davao City, Philippines', pageWidth / 2, yPos + 17, { align: 'center' });
                doc.text('Email: info@softwear.ph  |  www.softwear.ph', pageWidth / 2, yPos + 21, { align: 'center' });
                
                yPos += 26;
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                
                // === REPORT TITLE ===
                yPos += 12;
                doc.setFillColor(243, 244, 246);
                doc.roundedRect(15, yPos, pageWidth - 30, 24, 3, 3, 'F');
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(14);
                doc.setTextColor(30, 58, 95);
                doc.text(data.title || 'Permission Requests Report', pageWidth / 2, yPos + 10, { align: 'center' });
                
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Admin Portal â€¢ ' + data.dateRange, pageWidth / 2, yPos + 18, { align: 'center' });
                
                yPos += 32;
                
                // === REPORT INFO ===
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                doc.setTextColor(75, 85, 99);
                doc.text('Generated by: ' + data.printedBy, 15, yPos);
                doc.text('Date: ' + data.printedAt, pageWidth - 15, yPos, { align: 'right' });
                doc.text('Total Records: ' + data.totalCount, 15, yPos + 5);
                
                // === PERMISSION REQUESTS TABLE ===
                yPos += 15;
                
                const recordsData = data.records && data.records.length > 0
                    ? data.records.map(r => [r.user || '', r.email || '', r.requestType || '', r.requestedDate || ''])
                    : [['No permission requests found', '', '', '']];
                
                doc.autoTable({
                    startY: yPos,
                    head: [['User', 'Email', 'Request Type', 'Requested Date']],
                    body: recordsData,
                    theme: 'grid',
                    headStyles: { fillColor: [30, 58, 95], fontSize: 8, fontStyle: 'bold' },
                    bodyStyles: { fontSize: 7 },
                    columnStyles: {
                        0: { cellWidth: 40 },
                        1: { cellWidth: 'auto' },
                        2: { cellWidth: 45 },
                        3: { cellWidth: 30 }
                    },
                    margin: { left: 15, right: 15 },
                    didDrawPage: function(data) {
                        // Page number
                        doc.setFontSize(8);
                        doc.setTextColor(128);
                        doc.text('Page ' + data.pageNumber, pageWidth / 2, pageHeight - 10, { align: 'center' });
                    }
                });
                
                yPos = doc.lastAutoTable.finalY + 10;
                
                // === NOTHING FOLLOWS ===
                checkNewPage(50);
                doc.setLineDashPattern([2, 2], 0);
                doc.setDrawColor(107, 114, 128);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                doc.setFont('helvetica', 'italic');
                doc.setFontSize(10);
                doc.setTextColor(107, 114, 128);
                doc.text('*** NOTHING FOLLOWS ***', pageWidth / 2, yPos, { align: 'center' });
                yPos += 8;
                doc.line(15, yPos, pageWidth - 15, yPos);
                doc.setLineDashPattern([], 0);
                
                // === FOOTER ===
                yPos += 15;
                checkNewPage(40);
                doc.setDrawColor(30, 58, 95);
                doc.setLineWidth(0.5);
                doc.line(15, yPos, pageWidth - 15, yPos);
                yPos += 8;
                
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(8);
                doc.setTextColor(31, 41, 55);
                doc.text('SOFTWEAR', 15, yPos);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(7);
                doc.setTextColor(107, 114, 128);
                doc.text('Inventory Management System', 15, yPos + 4);
                doc.text('This is a computer-generated report.', 15, yPos + 8);
                doc.text('Document ID: PRM-' + Date.now(), 15, yPos + 12);
                
                doc.setDrawColor(31, 41, 55);
                doc.line(pageWidth - 65, yPos + 15, pageWidth - 15, yPos + 15);
                doc.setFontSize(7);
                doc.setTextColor(75, 85, 99);
                doc.text('Authorized Signature', pageWidth - 40, yPos + 20, { align: 'center' });
                
                const fileName = 'Permission_Requests_' + new Date().toISOString().slice(0, 10) + '.pdf';
                doc.save(fileName);
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Failed to generate PDF. Please try again.');
            }
        };
    </script>

</body>

</html>